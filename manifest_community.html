<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <title>Manifest Portal</title>
    <script src="js/api-base.js"></script>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/play-billing.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/gamification-engine.js"></script>
    <script src="js/profile.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0a0a1a;
            color: #fff;
            min-height: 100dvh;
            padding-bottom: 140px;
        }

        /* Sort Tabs */
        .sort-tabs { display: flex; gap: 0; background: rgba(255,255,255,0.05); border-radius: 9999px; padding: 3px; }
        .sort-tab { flex: 1; padding: 8px 4px; border-radius: 9999px; font-size: 11px; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; border: none; cursor: pointer; transition: all 0.25s; text-align: center; }
        .sort-tab.active { background: #7c3aed; color: #fff; box-shadow: 0 2px 12px rgba(124,58,237,0.4); }
        .sort-tab:not(.active) { background: transparent; color: rgba(255,255,255,0.35); }

        /* Category Chips */
        .cat-chip { padding: 7px 14px; border-radius: 9999px; font-size: 11px; font-weight: 600; border: 1px solid rgba(255,255,255,0.08); cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 5px; white-space: nowrap; background: rgba(255,255,255,0.04); color: rgba(255,255,255,0.4); }
        .cat-chip.active { background: rgba(124,58,237,0.2); color: #c084fc; border-color: rgba(124,58,237,0.5); }

        /* Weekly Champion Card */
        .weekly-card {
            background: linear-gradient(160deg, rgba(25,15,45,0.95) 0%, rgba(15,8,30,1) 100%);
            border: 1px solid rgba(124,58,237,0.25);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .weekly-card::before {
            content: '';
            position: absolute;
            top: -40%; right: -20%;
            width: 60%; height: 80%;
            background: radial-gradient(circle, rgba(124,58,237,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        .weekly-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-size: 8px;
            font-weight: 800;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            padding: 3px 8px;
            border-radius: 5px;
        }
        .ritual-btn {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: #fff;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 6px 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        /* Grid Manifest Cards */
        .manifest-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .grid-card {
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 160px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.15s;
        }
        .grid-card:active { transform: scale(0.97); }
        .grid-card::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, transparent 40%, rgba(0,0,0,0.3) 100%);
            pointer-events: none;
            border-radius: 16px;
        }
        .grid-card > * { position: relative; z-index: 1; }
        .cat-tag {
            font-size: 9px;
            font-weight: 800;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            padding: 3px 8px;
            border-radius: 6px;
            display: inline-block;
            width: fit-content;
        }

        /* Gradient presets for categories */
        .grad-love { background: linear-gradient(145deg, #be185d, #831843, #4a0728); }
        .grad-love .cat-tag { background: rgba(236,72,153,0.3); color: #f9a8d4; }

        .grad-money { background: linear-gradient(145deg, #065f46, #064e3b, #022c22); }
        .grad-money .cat-tag { background: rgba(16,185,129,0.3); color: #6ee7b7; }

        .grad-health { background: linear-gradient(145deg, #c2410c, #9a3412, #431407); }
        .grad-health .cat-tag { background: rgba(251,146,60,0.3); color: #fdba74; }

        .grad-career { background: linear-gradient(145deg, #7c2d12, #92400e, #451a03); }
        .grad-career .cat-tag { background: rgba(245,158,11,0.3); color: #fcd34d; }

        .grad-spiritual { background: linear-gradient(145deg, #5b21b6, #4c1d95, #2e1065); }
        .grad-spiritual .cat-tag { background: rgba(167,139,250,0.3); color: #c4b5fd; }

        .grad-general { background: linear-gradient(145deg, #1e3a5f, #172554, #0c1836); }
        .grad-general .cat-tag { background: rgba(96,165,250,0.3); color: #93c5fd; }

        /* FAB Button */
        .fab-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px; height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 24px rgba(124,58,237,0.45);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
            transition: transform 0.15s;
        }
        .fab-btn:active { transform: scale(0.9); }
        .fab-btn .material-symbols-outlined { font-size: 28px; color: #fff; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .fade-up { animation: fadeUp 0.35s ease forwards; opacity: 0; }
        .fd1 { animation-delay: 0.05s; }
        .fd2 { animation-delay: 0.1s; }
        .fd3 { animation-delay: 0.15s; }
        .fd4 { animation-delay: 0.2s; }
        .fd5 { animation-delay: 0.25s; }
        .fd6 { animation-delay: 0.3s; }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="px-5 pt-12 pb-2">
        <div class="flex items-center justify-between mb-5">
            <h1 class="text-[22px] font-bold tracking-tight">Manifest Portal</h1>
            <button onclick="showInfoModal()" class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center">
                <span class="material-symbols-outlined text-white/40 text-base">info</span>
            </button>
        </div>

        <!-- Sort Tabs -->
        <div class="sort-tabs mb-4">
            <button class="sort-tab active" data-sort="newest" onclick="switchSort(this)">Newest</button>
            <button class="sort-tab" data-sort="top_rated" onclick="switchSort(this)">Top Rated</button>
            <button class="sort-tab" data-sort="weekly" onclick="switchSort(this)">Weekly</button>
        </div>

        <!-- Category Chips -->
        <div class="flex gap-2 overflow-x-auto pb-3" style="scrollbar-width:none;">
            <button class="cat-chip active" data-cat="all" onclick="switchCat(this)">
                <span class="material-symbols-outlined" style="font-size:13px;">all_inclusive</span> All
            </button>
            <button class="cat-chip" data-cat="money" onclick="switchCat(this)">üí∞ Money</button>
            <button class="cat-chip" data-cat="love" onclick="switchCat(this)">‚ù§Ô∏è Love</button>
            <button class="cat-chip" data-cat="health" onclick="switchCat(this)">üåø Health</button>
        </div>
    </div>

    <!-- Feed -->
    <div id="manifest-feed" class="px-5"></div>

    <!-- Info Modal -->
    <div id="info-modal" style="display:none; position:fixed; inset:0; z-index:200; background:rgba(0,0,0,0.7); backdrop-filter:blur(6px); align-items:center; justify-content:center;">
        <div style="background:rgba(20,15,35,0.98); border:1px solid rgba(124,58,237,0.3); border-radius:20px; padding:28px; max-width:320px; width:90%; text-align:center;">
            <span class="material-symbols-outlined text-4xl text-purple-400 mb-3" style="font-variation-settings:'FILL' 1;">auto_awesome</span>
            <h3 class="text-lg font-bold mb-2">Manifest Portal</h3>
            <p class="text-white/50 text-sm leading-relaxed mb-5">Topluluk manifestlerini ke≈üfet, ilham al ve kendi niyetlerini evrene g√∂nder. Birlikte manifest olu≈üturmak enerjinizi katlar!</p>
            <button onclick="closeInfoModal()" class="w-full py-3 rounded-full bg-purple-600 text-white font-semibold text-sm cursor-pointer">Anladƒ±m</button>
        </div>
    </div>

    <!-- FAB -->
    <button class="fab-btn" onclick="window.location.href='cosmic_manifest_portal.html'">
        <span class="material-symbols-outlined">add</span>
    </button>

    <script>
    (function() {
        'use strict';

        var currentSort = 'newest';
        var currentCat = 'all';

        // ‚îÄ‚îÄ‚îÄ Kategori config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        var CAT_CONFIG = {
            love:      { label: 'LOVE',      grad: 'grad-love' },
            money:     { label: 'WEALTH',    grad: 'grad-money' },
            health:    { label: 'ENERGY',    grad: 'grad-health' },
            career:    { label: 'CAREER',    grad: 'grad-career' },
            spiritual: { label: 'IDEA',      grad: 'grad-spiritual' },
            general:   { label: 'GENERAL',   grad: 'grad-general' }
        };

        // ‚îÄ‚îÄ‚îÄ Sample Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        var MANIFESTS = [
            { id: 1, user: 'MysticSoul_88', path: 7, text: '"I am a magnet for boundless prosperity and soulful opportunities."', likes: 3200, category: 'money', weekly: true },
            { id: 2, user: 'luna_3', path: 3, text: '"I am worthy of deep, unconditional love."', likes: 142, category: 'love', weekly: false },
            { id: 3, user: 'iris_23', path: 5, text: '"Abundance flows to me effortlessly today."', likes: 96, category: 'money', weekly: false },
            { id: 4, user: 'nova_8', path: 8, text: '"My body is a temple of vibrant health."', likes: 78, category: 'health', weekly: false },
            { id: 5, user: 'zen_11', path: 11, text: '"I trust the timing of my cosmic journey."', likes: 134, category: 'spiritual', weekly: false },
            { id: 6, user: 'aura_6', path: 6, text: '"Love surrounds me in every moment."', likes: 267, category: 'love', weekly: false },
            { id: 7, user: 'star_1', path: 1, text: '"My career is guided by purpose and light."', likes: 189, category: 'career', weekly: false },
            { id: 8, user: 'moon_9', path: 9, text: '"I release what no longer serves my soul."', likes: 312, category: 'spiritual', weekly: false },
            { id: 9, user: 'sol_22', path: 22, text: '"Wealth flows through me like cosmic energy."', likes: 445, category: 'money', weekly: false },
            { id: 10, user: 'gaia_4', path: 4, text: '"Every cell in my body radiates health."', likes: 156, category: 'health', weekly: false }
        ];

        // ‚îÄ‚îÄ‚îÄ User manifests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function loadUserManifests() {
            try {
                var authData = JSON.parse(localStorage.getItem('numerael-auth-token') || 'null');
                if (!authData || !authData.user) return [];
                var ud = JSON.parse(localStorage.getItem('numerael_user_data') || 'null');
                var stored = JSON.parse(localStorage.getItem('numerael_manifests_' + authData.user.id) || '[]');
                var userName = (ud && ud.name) ? ud.name.split(' ')[0] : 'You';
                return stored.map(function(m, i) {
                    return {
                        id: 1000 + i,
                        user: userName,
                        path: null,
                        text: '"' + (m.text || m.intention || '') + '"',
                        likes: Math.floor(Math.random() * 50) + 5,
                        category: 'general',
                        weekly: false,
                        isOwn: true
                    };
                });
            } catch(e) { return []; }
        }

        // ‚îÄ‚îÄ‚îÄ Format likes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function fmtLikes(n) {
            if (n >= 1000) return (n / 1000).toFixed(1) + 'k';
            return n.toString();
        }

        // ‚îÄ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function render() {
            var feed = document.getElementById('manifest-feed');
            var userM = loadUserManifests().reverse();
            var all = userM.concat(MANIFESTS);

            // Filter
            var items = all;
            if (currentCat !== 'all') {
                items = all.filter(function(m) { return m.category === currentCat; });
            }

            // Sort
            if (currentSort === 'top_rated') {
                items.sort(function(a, b) { return b.likes - a.likes; });
            } else if (currentSort === 'weekly') {
                items = items.filter(function(m) { return m.weekly || m.likes > 150; });
                items.sort(function(a, b) { return b.likes - a.likes; });
            }

            if (items.length === 0) {
                feed.innerHTML = '<div class="text-center py-16"><span class="material-symbols-outlined text-white/10" style="font-size:48px;font-variation-settings:\'FILL\' 1;">search_off</span><p class="text-white/25 text-sm mt-3">Bu kategoride manifest bulunamadƒ±</p></div>';
                return;
            }

            var html = '';

            // Weekly Champion (only in newest + all)
            var weeklyItem = null;
            if (currentSort === 'newest' && currentCat === 'all') {
                for (var w = 0; w < items.length; w++) {
                    if (items[w].weekly) { weeklyItem = items[w]; items.splice(w, 1); break; }
                }
            }

            if (weeklyItem) {
                html += '<div class="weekly-card fade-up fd1 mb-4">' +
                    '<div class="flex items-center justify-between mb-3">' +
                        '<span class="weekly-badge">WEEKLY CHAMPION</span>' +
                        '<span class="text-white/30 text-xs">' + fmtLikes(weeklyItem.likes) + ' <span class="material-symbols-outlined" style="font-size:12px;vertical-align:middle;">favorite</span></span>' +
                    '</div>' +
                    '<p class="text-white text-lg font-light leading-relaxed italic mb-4">' + weeklyItem.text + '</p>' +
                    '<div class="flex items-center justify-between">' +
                        '<div class="flex items-center gap-2">' +
                            '<div style="width:28px;height:28px;border-radius:50%;background:#7c3aed;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;">' + weeklyItem.user.substring(0, 2).toUpperCase() + '</div>' +
                            '<div>' +
                                '<span class="text-white/80 text-xs font-semibold">' + weeklyItem.user + '</span>' +
                                (weeklyItem.path ? '<br><span class="text-white/25 text-[9px] tracking-wider">Life Path ' + weeklyItem.path + '</span>' : '') +
                            '</div>' +
                        '</div>' +
                        '<button class="ritual-btn">RITUAL</button>' +
                    '</div>' +
                '</div>';
            }

            // Grid cards
            html += '<div class="manifest-grid">';
            for (var i = 0; i < items.length; i++) {
                var m = items[i];
                var cat = CAT_CONFIG[m.category] || CAT_CONFIG.general;
                var d = Math.min(i + 2, 6);
                html += '<div class="grid-card ' + cat.grad + ' fade-up fd' + d + '">' +
                    '<div>' +
                        '<span class="cat-tag">' + cat.label + '</span>' +
                        '<p class="text-white text-[13px] font-medium leading-snug mt-3">' + m.text + '</p>' +
                    '</div>' +
                    '<div class="flex items-center justify-between mt-3">' +
                        '<span class="text-white/40 text-[10px]">@' + m.user + '</span>' +
                        '<span class="text-white/30 text-[10px]">' + fmtLikes(m.likes) + ' <span class="material-symbols-outlined" style="font-size:10px;vertical-align:middle;">favorite</span></span>' +
                    '</div>' +
                '</div>';
            }
            html += '</div>';

            feed.innerHTML = html;
        }

        // ‚îÄ‚îÄ‚îÄ Global handlers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        window.switchSort = function(btn) {
            currentSort = btn.getAttribute('data-sort');
            var tabs = document.querySelectorAll('.sort-tab');
            for (var i = 0; i < tabs.length; i++) tabs[i].classList.remove('active');
            btn.classList.add('active');
            render();
        };

        window.switchCat = function(btn) {
            currentCat = btn.getAttribute('data-cat');
            var chips = document.querySelectorAll('.cat-chip');
            for (var i = 0; i < chips.length; i++) chips[i].classList.remove('active');
            btn.classList.add('active');
            render();
        };

        window.showInfoModal = function() {
            document.getElementById('info-modal').style.display = 'flex';
        };

        window.closeInfoModal = function() {
            document.getElementById('info-modal').style.display = 'none';
        };

        // ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function init() {
            if (window.auth && window.auth.whenReady) await window.auth.whenReady();
            if (window.gamification) window.gamification.trackAction('manifest_community_visit');
            render();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
    <script src="js/notification-engine.js"></script>
    <script src="js/bottom-nav.js"></script>
</body>
</html>
