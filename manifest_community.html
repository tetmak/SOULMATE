<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <title>Manifest Portal</title>
    <script src="js/theme-engine.js"></script>
    <script src="js/api-base.js"></script>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/play-billing.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/gamification-engine.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/manifest-engine.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "background-light": "#f8f8f5",
                        "background-dark": "#0f0a19",
                        "card-light": "#ffffff",
                        "card-dark": "#1a1226"
                    },
                    fontFamily: {
                        display: ["Plus Jakarta Sans", "sans-serif"]
                    }
                }
            }
        };
    </script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100dvh;
            padding-bottom: 140px;
            position: relative;
        }
        body > * { position: relative; z-index: 1; }

        /* â”€â”€ Scrollbar hide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* â”€â”€ Header title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .page-title {
            background: linear-gradient(90deg, #fb7ba2, #f9a858);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 22px;
            font-weight: 700;
        }

        /* â”€â”€ Sort Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sort-tabs {
            display: flex;
            gap: 0;
            border-radius: 16px;
            padding: 6px;
        }
        html.dark .sort-tabs { background: rgba(255,255,255,0.05); }
        html:not(.dark) .sort-tabs { background: rgba(0,0,0,0.04); }
        .sort-tab {
            flex: 1;
            padding: 10px 4px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            transition: all 0.25s;
            text-align: center;
        }
        html.dark .sort-tab.active {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }
        html:not(.dark) .sort-tab.active {
            background: #fff;
            color: #1a1a2e;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        html.dark .sort-tab:not(.active) {
            background: transparent;
            color: rgba(255,255,255,0.3);
        }
        html:not(.dark) .sort-tab:not(.active) {
            background: transparent;
            color: rgba(0,0,0,0.35);
        }

        /* â”€â”€ Category Chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .cat-row { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; }
        .cat-row::-webkit-scrollbar { display: none; }
        .cat-chip {
            padding: 8px 20px;
            border-radius: 9999px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        html.dark .cat-chip {
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.4);
        }
        html:not(.dark) .cat-chip {
            border: 1px solid rgba(0,0,0,0.1);
            background: rgba(0,0,0,0.03);
            color: rgba(0,0,0,0.4);
        }
        html.dark .cat-chip.active {
            background: #fff;
            color: #000;
            border-color: #fff;
            font-weight: 700;
        }
        html:not(.dark) .cat-chip.active {
            background: #1a1a2e;
            color: #fff;
            border-color: #1a1a2e;
            font-weight: 700;
        }

        /* â”€â”€ Weekly Champion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .weekly-card {
            border: 2px solid #D4AF37;
            box-shadow: 0 10px 30px -5px rgba(212,175,55,0.3);
            border-radius: 24px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        html.dark .weekly-card {
            background: linear-gradient(145deg, #2d1b4d 0%, #1a1226 100%);
        }
        html:not(.dark) .weekly-card {
            background: linear-gradient(145deg, #f5f0ff 0%, #fffbf0 100%);
        }
        .weekly-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #D4AF37;
            color: #0f0a19;
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 5px 12px;
            border-radius: 9999px;
        }
        .weekly-likes {
            color: rgba(212,175,55,0.6);
            font-size: 11px;
            font-weight: 700;
        }
        .weekly-quote {
            font-size: 20px;
            font-weight: 700;
            line-height: 1.4;
        }
        html.dark .weekly-quote { color: #fff; }
        html:not(.dark) .weekly-quote { color: #1a1a2e; }
        .ritual-btn {
            background: rgba(212,175,55,0.1);
            color: #D4AF37;
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 8px 18px;
            border-radius: 9999px;
            border: 1px solid rgba(212,175,55,0.2);
            cursor: pointer;
            transition: all 0.2s;
        }
        .ritual-btn:active { transform: scale(0.95); }
        .user-pill {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar-sm {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 700;
            flex-shrink: 0;
            border: 2px solid rgba(212,175,55,0.3);
            padding: 2px;
        }

        /* â”€â”€ Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .manifest-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* â”€â”€ Grid Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .grid-card {
            border-radius: 24px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
            cursor: pointer;
            transition: transform 0.15s;
            position: relative;
            box-shadow: 0 8px 24px -4px rgba(0,0,0,0.15);
        }
        .grid-card:active { transform: scale(0.97); }

        /* Category icon */
        .cat-icon-wrap {
            width: 24px; height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .cat-icon-wrap .material-symbols-outlined {
            font-size: 14px;
        }
        .cat-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            width: fit-content;
        }

        /* Pastel gradient palettes */
        .grad-love {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
        .grad-love .cat-tag { color: rgba(150,30,80,0.7); }
        .grad-love .cat-icon-wrap { background: rgba(255,255,255,0.3); }
        .grad-love .cat-icon-wrap .material-symbols-outlined { color: rgba(150,30,80,0.7); }

        .grad-money {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }
        .grad-money .cat-tag { color: rgba(140,60,0,0.7); }
        .grad-money .cat-icon-wrap .material-symbols-outlined { color: rgba(140,60,0,0.7); }

        .grad-health {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }
        .grad-health .cat-tag { color: rgba(0,100,100,0.7); }
        .grad-health .cat-icon-wrap .material-symbols-outlined { color: rgba(0,100,100,0.7); }

        .grad-spiritual {
            background: linear-gradient(135deg, #fbc2eb 0%, #f6a085 100%);
        }
        .grad-spiritual .cat-tag { color: rgba(140,40,80,0.7); }
        .grad-spiritual .cat-icon-wrap .material-symbols-outlined { color: rgba(140,40,80,0.7); }

        .grad-career {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .grad-career .cat-tag { color: rgba(140,70,20,0.7); }
        .grad-career .cat-icon-wrap .material-symbols-outlined { color: rgba(140,70,20,0.7); }

        .grad-general {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        .grad-general .cat-tag { color: rgba(30,60,120,0.7); }
        .grad-general .cat-icon-wrap .material-symbols-outlined { color: rgba(30,60,120,0.7); }

        /* Card text */
        .card-quote {
            font-size: 14px;
            font-weight: 700;
            line-height: 1.5;
            color: rgba(0,0,0,0.82);
            margin-top: 12px;
        }
        .card-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 12px;
        }
        .card-user {
            font-size: 10px;
            font-weight: 700;
            color: rgba(0,0,0,0.4);
        }
        .card-likes {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 10px;
            font-weight: 700;
            color: rgba(0,0,0,0.35);
        }
        .card-likes .material-symbols-outlined {
            font-size: 16px;
            transition: all 0.2s;
        }
        .card-likes:active .material-symbols-outlined {
            transform: scale(1.3);
        }

        /* â”€â”€ Real user badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .real-user-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            background: rgba(255,255,255,0.2);
            color: #fff;
            font-size: 8px;
            font-weight: 800;
            letter-spacing: 0.08em;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 4px;
        }
        .grid-card.real-user-card {
            border: 1.5px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 12px rgba(168,85,247,0.15);
        }

        /* â”€â”€ Champion badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .champion-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            background: rgba(245,158,11,0.2);
            color: #f59e0b;
            font-size: 8px;
            font-weight: 800;
            letter-spacing: 0.08em;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 4px;
        }
        .grid-card.champion-card {
            border: 1.5px solid rgba(245,158,11,0.25);
            box-shadow: 0 0 12px rgba(245,158,11,0.1);
        }

        /* â”€â”€ My Manifests Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .my-manifests-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            border-radius: 9999px;
            background: rgba(127,19,236,0.15);
            border: 1px solid rgba(127,19,236,0.3);
            color: #a78bfa;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .my-manifests-btn:active { transform: scale(0.95); }
        .my-manifests-btn .material-symbols-outlined { font-size: 16px; }

        /* â”€â”€ My Manifests Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .my-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 200;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .my-modal-panel {
            position: absolute;
            inset: 0;
            top: 40px;
            border-radius: 24px 24px 0 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        html.dark .my-modal-panel { background: linear-gradient(180deg, #16102a 0%, #0f0a19 100%); }
        html:not(.dark) .my-modal-panel { background: linear-gradient(180deg, #ffffff 0%, #f8f8f5 100%); }
        .my-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 20px 16px;
            flex-shrink: 0;
        }
        html.dark .my-modal-header { border-bottom: 1px solid rgba(255,255,255,0.06); }
        html:not(.dark) .my-modal-header { border-bottom: 1px solid rgba(0,0,0,0.08); }
        .my-modal-title {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(90deg, #fb7ba2, #f9a858);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .my-modal-close {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        html.dark .my-modal-close { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.4); }
        html:not(.dark) .my-modal-close { background: rgba(0,0,0,0.05); color: rgba(0,0,0,0.4); }
        .my-modal-close:active { transform: scale(0.9); }
        .my-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px 100px;
            -webkit-overflow-scrolling: touch;
        }
        .my-manifest-item {
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }
        html.dark .my-manifest-item { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); }
        html:not(.dark) .my-manifest-item { background: #fff; border: 1px solid rgba(0,0,0,0.06); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .my-manifest-cat {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            font-weight: 800;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 3px 8px;
            border-radius: 6px;
            background: rgba(127,19,236,0.15);
            color: #a78bfa;
            margin-bottom: 8px;
        }
        .my-manifest-text {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        html.dark .my-manifest-text { color: rgba(255,255,255,0.85); }
        html:not(.dark) .my-manifest-text { color: rgba(0,0,0,0.75); }
        .my-manifest-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .my-manifest-date {
            font-size: 11px;
        }
        html.dark .my-manifest-date { color: rgba(255,255,255,0.25); }
        html:not(.dark) .my-manifest-date { color: rgba(0,0,0,0.3); }
        .my-manifest-likes {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
        }
        html.dark .my-manifest-likes { color: rgba(255,255,255,0.35); }
        html:not(.dark) .my-manifest-likes { color: rgba(0,0,0,0.4); }
        .my-manifest-likes .material-symbols-outlined {
            font-size: 14px;
            color: #a78bfa;
        }
        .my-manifest-delete {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px; height: 28px;
            border-radius: 50%;
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .my-manifest-delete:active { transform: scale(0.85); }
        .my-manifest-delete .material-symbols-outlined {
            font-size: 14px;
            color: rgba(239,68,68,0.6);
        }
        .my-modal-empty {
            text-align: center;
            padding: 60px 20px;
        }
        .my-modal-count {
            font-size: 12px;
            font-weight: 500;
        }
        html.dark .my-modal-count { color: rgba(255,255,255,0.3); }
        html:not(.dark) .my-modal-count { color: rgba(0,0,0,0.35); }

        /* â”€â”€ FAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .fab-btn {
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 56px; height: 56px;
            border-radius: 50%;
            background: #7f13ec;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(127,19,236,0.4);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
            transition: transform 0.15s;
        }
        .fab-btn:active { transform: scale(0.9); }
        .fab-btn .material-symbols-outlined { font-size: 28px; color: #fff; }

        /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
        .fade-up { animation: fadeUp 0.35s ease forwards; opacity: 0; }
        .fd1 { animation-delay: 0.03s; }
        .fd2 { animation-delay: 0.08s; }
        .fd3 { animation-delay: 0.13s; }
        .fd4 { animation-delay: 0.18s; }
        .fd5 { animation-delay: 0.23s; }
        .fd6 { animation-delay: 0.28s; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white">

    <!-- Header -->
    <header class="sticky top-0 z-20 backdrop-blur-md border-b border-slate-200 dark:border-white/5 px-6 py-4 flex items-center justify-between bg-background-light/80 dark:bg-background-dark/80">
        <h1 class="page-title">Manifest Portal</h1>
        <div class="flex items-center gap-2">
            <button class="my-manifests-btn" onclick="openMyManifests()">
                <span class="material-symbols-outlined" style="font-variation-settings:'FILL' 1;">auto_awesome</span>
                My Manifests
            </button>
            <button onclick="showInfoModal()" class="w-9 h-9 rounded-full flex items-center justify-center bg-slate-100 dark:bg-white/5">
                <span class="material-symbols-outlined text-slate-400" style="font-size:20px;">info</span>
            </button>
        </div>
    </header>

    <div class="px-4 pt-6 pb-2">
        <!-- Sort Tabs -->
        <div class="sort-tabs mb-6">
            <button class="sort-tab active" data-sort="newest" onclick="switchSort(this)">Newest</button>
            <button class="sort-tab" data-sort="top_rated" onclick="switchSort(this)">Top Rated</button>
            <button class="sort-tab" data-sort="weekly" onclick="switchSort(this)">Weekly</button>
        </div>

        <!-- Category Chips -->
        <div class="cat-row no-scrollbar pb-3">
            <button class="cat-chip active" data-cat="all" onclick="switchCat(this)">All</button>
            <button class="cat-chip" data-cat="money" onclick="switchCat(this)">Money</button>
            <button class="cat-chip" data-cat="love" onclick="switchCat(this)">Love</button>
            <button class="cat-chip" data-cat="health" onclick="switchCat(this)">Health</button>
            <button class="cat-chip" data-cat="career" onclick="switchCat(this)">Career</button>
            <button class="cat-chip" data-cat="spiritual" onclick="switchCat(this)">Soul</button>
        </div>
    </div>

    <!-- Feed -->
    <div id="manifest-feed" class="px-4"></div>

    <!-- Info Modal -->
    <div id="info-modal" style="display:none; position:fixed; inset:0; z-index:200; background:rgba(0,0,0,0.7); backdrop-filter:blur(6px); align-items:center; justify-content:center;">
        <div class="bg-white dark:bg-[rgba(22,16,42,0.98)] border border-slate-200 dark:border-[rgba(127,19,236,0.3)]" style="border-radius:20px; padding:28px; max-width:320px; width:90%; text-align:center;">
            <span class="material-symbols-outlined text-4xl mb-3" style="font-variation-settings:'FILL' 1;color:#a78bfa;">auto_awesome</span>
            <h3 class="text-lg font-bold mb-2 text-slate-900 dark:text-white">Manifest Portal</h3>
            <p class="text-slate-500 dark:text-white/50 text-sm leading-relaxed mb-5">Topluluk manifestlerini keÅŸfet, ilham al ve kendi niyetlerini evrene gÃ¶nder. Birlikte manifest oluÅŸturmak enerjinizi katlar!</p>
            <button onclick="closeInfoModal()" class="w-full py-3 rounded-full text-white font-semibold text-sm cursor-pointer" style="background:#7f13ec;">AnladÄ±m</button>
        </div>
    </div>

    <!-- My Manifests Modal -->
    <div id="my-manifests-modal" class="my-modal-overlay">
        <div class="my-modal-panel">
            <div class="my-modal-header">
                <div>
                    <span class="my-modal-title">My Manifests</span>
                    <span id="my-manifests-count" class="my-modal-count" style="margin-left:8px;"></span>
                </div>
                <button class="my-modal-close" onclick="closeMyManifests()">
                    <span class="material-symbols-outlined" style="font-size:18px;">close</span>
                </button>
            </div>
            <div id="my-manifests-body" class="my-modal-body"></div>
        </div>
    </div>

    <!-- FAB -->
    <button class="fab-btn" onclick="window.location.href='cosmic_manifest_portal.html'">
        <span class="material-symbols-outlined">add</span>
    </button>

    <script>
    (function() {
        'use strict';

        var currentSort = 'newest';
        var currentCat = 'all';
        var feedData = [];
        var isLoading = false;

        // â”€â”€â”€ Category Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var CAT_CFG = {
            love:      { label: 'LOVE',    grad: 'grad-love',      icon: 'favorite',  iconColor: 'rgba(150,30,80,0.7)' },
            money:     { label: 'WEALTH',  grad: 'grad-money',     icon: 'payments',  iconColor: 'rgba(140,60,0,0.7)' },
            health:    { label: 'ENERGY',  grad: 'grad-health',    icon: 'bolt',      iconColor: 'rgba(0,100,100,0.7)' },
            career:    { label: 'CAREER',  grad: 'grad-career',    icon: 'work',      iconColor: 'rgba(140,70,20,0.7)' },
            spiritual: { label: 'SOUL',    grad: 'grad-spiritual', icon: 'auto_fix',  iconColor: 'rgba(140,40,80,0.7)' },
            general:   { label: 'GENERAL', grad: 'grad-general',   icon: 'stars',     iconColor: 'rgba(30,60,120,0.7)' }
        };

        // â”€â”€â”€ Avatar colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var AVATAR_COLS = ['#7c3aed','#a855f7','#ec4899','#f43f5e','#f59e0b','#10b981','#06b6d4','#3b82f6','#6366f1','#8b5cf6'];
        function avatarColor(name) {
            var h = 0;
            for (var i = 0; i < name.length; i++) h = name.charCodeAt(i) + ((h << 5) - h);
            return AVATAR_COLS[Math.abs(h) % AVATAR_COLS.length];
        }
        function initials(name) {
            var p = name.trim().split(/[\s_]+/);
            return p.length >= 2 ? (p[0][0] + p[1][0]).toUpperCase() : name.substring(0, 2).toUpperCase();
        }
        function fmtLikes(n) { return n >= 1000 ? (n/1000).toFixed(1) + 'k' : '' + n; }

        // â”€â”€â”€ Fallback Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var FALLBACK = [
            { id:'f1', display_name:'Elif', life_path:7, text:'Evrenin bana gÃ¶nderdiÄŸi sevgiyi aÃ§Ä±k kalplerle karÅŸÄ±lÄ±yorum.', likes:287, category:'love', liked:false },
            { id:'f2', display_name:'Burak', life_path:3, text:'Bolluk ve bereket hayatÄ±mÄ±n her alanÄ±na akÄ±yor.', likes:214, category:'money', liked:false },
            { id:'f3', display_name:'Zeynep', life_path:11, text:'Ruhum her gÃ¼n daha derin bir farkÄ±ndalÄ±kla uyanÄ±yor.', likes:195, category:'spiritual', liked:false },
            { id:'f4', display_name:'Emre', life_path:5, text:'Kariyer yolculuÄŸumda evrenin rehberliÄŸine gÃ¼veniyorum.', likes:178, category:'career', liked:false },
            { id:'f5', display_name:'AyÅŸe', life_path:9, text:'Bedenim saÄŸlÄ±kla dolu, her hÃ¼crem Ä±ÅŸÄ±kla titreÅŸiyor.', likes:162, category:'health', liked:false }
        ];

        // â”€â”€â”€ Supabase'den feed yÃ¼kle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function loadFromSupabase() {
            if (!window.manifestEngine) return FALLBACK;
            try {
                var data = await window.manifestEngine.loadFeed(currentSort, currentCat, 100);
                if (data && data.length > 0) return data;
                return FALLBACK;
            } catch(e) {
                console.warn('[ManifestCommunity] Supabase load failed, using fallback:', e);
                return FALLBACK;
            }
        }

        // â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function render() {
            var feed = document.getElementById('manifest-feed');
            var all = feedData.slice();

            if (!all.length) {
                feed.innerHTML = '<div class="text-center py-16"><span class="material-symbols-outlined text-slate-200 dark:text-white/[0.06]" style="font-size:48px;font-variation-settings:\'FILL\' 1;">search_off</span><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:14px;margin-top:12px;">Bu kategoride manifest bulunamadÄ±</p></div>';
                return;
            }

            var html = '';

            // â”€â”€ Weekly Champion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            var weekly = null;
            if (currentSort === 'newest' && currentCat === 'all' && all.length > 0) {
                var topIdx = 0;
                for (var w = 1; w < all.length; w++) {
                    if ((all[w].likes || 0) > (all[topIdx].likes || 0)) topIdx = w;
                }
                if ((all[topIdx].likes || 0) >= 5) {
                    weekly = all[topIdx];
                    all.splice(topIdx, 1);
                }
            }

            if (weekly) {
                var wName = weekly.display_name || 'User';
                var wc = avatarColor(wName);
                var wi = initials(wName);
                var wIsReal = !weekly.isBot;
                html += '<div class="weekly-card fade-up fd1 mb-4">' +
                    '<div class="flex items-center justify-between mb-4">' +
                        '<span class="weekly-badge">ğŸ† Weekly Champion</span>' +
                        '<span class="weekly-likes">' + fmtLikes(weekly.likes || 0) + ' Likes</span>' +
                    '</div>' +
                    '<p class="weekly-quote mb-6">"' + weekly.text + '"</p>' +
                    '<div class="flex items-center justify-between">' +
                        '<div class="user-pill">' +
                            '<div class="user-avatar-sm" style="background:linear-gradient(135deg,' + wc + ',#f59e0b);">' + wi + '</div>' +
                            '<div style="line-height:1.2;">' +
                                '<div style="font-size:12px;font-weight:700;color:#D4AF37;">' + wName + '</div>' +
                                (weekly.life_path ? '<div class="text-slate-400 dark:text-white/30" style="font-size:10px;font-weight:500;">Life Path ' + weekly.life_path + '</div>' : '') +
                            '</div>' +
                        '</div>' +
                        '<button class="ritual-btn" onclick="handleLike(\'' + weekly.id + '\')">Ritual</button>' +
                    '</div>' +
                '</div>';
            }

            // â”€â”€ Grid Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            html += '<div class="manifest-grid">';
            for (var i = 0; i < all.length; i++) {
                var m = all[i];
                var c = CAT_CFG[m.category] || CAT_CFG.general;
                var d = Math.min(i + 2, 6);
                var mName = m.display_name || 'User';
                var likedFill = m.liked ? '1' : '0';
                var isReal = !m.isBot;
                var isChamp = !!m.isChampion;
                var extraClass = isChamp ? ' champion-card' : (isReal ? ' real-user-card' : '');

                var champLabel = '';
                if (isChamp && m.championWeek) {
                    var wd = new Date(m.championWeek);
                    var weekNum = Math.ceil(((wd - new Date(wd.getFullYear(), 0, 1)) / 86400000 + 1) / 7);
                    champLabel = '<span class="champion-badge">ğŸ† Week ' + weekNum + '</span>';
                }

                html += '<div class="grid-card ' + c.grad + extraClass + ' fade-up fd' + d + '">' +
                    '<div>' +
                        '<div class="cat-tag">' +
                            '<div class="cat-icon-wrap"><span class="material-symbols-outlined" style="font-variation-settings:\'FILL\' 1;">' + c.icon + '</span></div>' +
                            '<span>' + c.label + '</span>' +
                        '</div>' +
                        (isChamp ? champLabel : (isReal ? '<span class="real-user-badge">âœ¨ GERÃ‡EK</span>' : '')) +
                        '<p class="card-quote">"' + m.text + '"</p>' +
                    '</div>' +
                    '<div class="card-bottom">' +
                        '<span class="card-user">@' + mName + '</span>' +
                        (isChamp ?
                            '<span class="card-likes" style="color:rgba(245,158,11,0.6);"><span class="material-symbols-outlined" style="font-size:16px;font-variation-settings:\'FILL\' 1;color:rgba(245,158,11,0.6);">thumb_up</span> ' + fmtLikes(m.likes || 0) + '</span>'
                        :
                            '<button class="card-likes" onclick="event.stopPropagation();handleLike(\'' + m.id + '\')" style="background:none;border:none;cursor:pointer;padding:2px 4px;border-radius:8px;">' +
                                '<span class="material-symbols-outlined" style="font-variation-settings:\'FILL\' ' + likedFill + ';' + (m.liked ? 'color:rgba(220,50,50,0.7);' : '') + '">thumb_up</span> ' + fmtLikes(m.likes || 0) +
                            '</button>'
                        ) +
                    '</div>' +
                '</div>';
            }
            html += '</div>';

            feed.innerHTML = html;
        }

        // â”€â”€â”€ Like Handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.handleLike = async function(manifestId) {
            if (!manifestId || manifestId.startsWith('f')) return;
            if (!window.manifestEngine) {
                console.warn('[ManifestCommunity] No manifestEngine â€” cannot like');
                return;
            }

            console.log('[ManifestCommunity] handleLike called:', manifestId);

            var prevLiked = null;
            var prevLikes = null;
            for (var i = 0; i < feedData.length; i++) {
                if (feedData[i].id === manifestId) {
                    prevLiked = feedData[i].liked;
                    prevLikes = feedData[i].likes || 0;
                    feedData[i].liked = !feedData[i].liked;
                    feedData[i].likes = prevLikes + (feedData[i].liked ? 1 : -1);
                    if (feedData[i].likes < 0) feedData[i].likes = 0;
                    break;
                }
            }
            render();

            var result = await window.manifestEngine.toggleLike(manifestId);
            console.log('[ManifestCommunity] toggleLike result:', JSON.stringify(result));

            if (result.success) {
                for (var j = 0; j < feedData.length; j++) {
                    if (feedData[j].id === manifestId) {
                        feedData[j].likes = result.newCount;
                        feedData[j].liked = (result.action === 'liked');
                        break;
                    }
                }
                render();
            } else {
                console.warn('[ManifestCommunity] Like failed, reverting UI');
                for (var k = 0; k < feedData.length; k++) {
                    if (feedData[k].id === manifestId) {
                        feedData[k].liked = prevLiked;
                        feedData[k].likes = prevLikes;
                        break;
                    }
                }
                render();
            }
        };

        // â”€â”€â”€ Sort/Category â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function reloadFeed() {
            if (isLoading) return;
            isLoading = true;
            var feed = document.getElementById('manifest-feed');
            feed.innerHTML = '<div class="text-center py-12"><div style="width:28px;height:28px;border:2px solid rgba(127,19,236,0.3);border-top-color:#7f13ec;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto;"></div><style>@keyframes spin{to{transform:rotate(360deg)}}</style><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:12px;margin-top:12px;">YÃ¼kleniyor...</p></div>';

            feedData = await loadFromSupabase();
            isLoading = false;
            render();
        }

        // â”€â”€â”€ Global Handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.switchSort = function(btn) {
            currentSort = btn.getAttribute('data-sort');
            var t = document.querySelectorAll('.sort-tab');
            for (var i = 0; i < t.length; i++) t[i].classList.remove('active');
            btn.classList.add('active');
            reloadFeed();
        };
        window.switchCat = function(btn) {
            currentCat = btn.getAttribute('data-cat');
            var c = document.querySelectorAll('.cat-chip');
            for (var i = 0; i < c.length; i++) c[i].classList.remove('active');
            btn.classList.add('active');
            reloadFeed();
        };
        window.showInfoModal = function() { document.getElementById('info-modal').style.display = 'flex'; };
        window.closeInfoModal = function() { document.getElementById('info-modal').style.display = 'none'; };

        // â”€â”€â”€ My Manifests Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var CAT_LABELS = { love: 'Love', money: 'Wealth', health: 'Energy', career: 'Career', spiritual: 'Soul', general: 'General' };

        window.openMyManifests = async function() {
            var modal = document.getElementById('my-manifests-modal');
            var body = document.getElementById('my-manifests-body');
            var countEl = document.getElementById('my-manifests-count');
            modal.style.display = 'block';

            body.innerHTML = '<div class="text-center py-12"><div style="width:28px;height:28px;border:2px solid rgba(127,19,236,0.3);border-top-color:#7f13ec;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto;"></div><style>@keyframes spin{to{transform:rotate(360deg)}}</style><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:12px;margin-top:12px;">Loading...</p></div>';

            if (!window.manifestEngine) {
                body.innerHTML = '<div class="my-modal-empty"><span class="material-symbols-outlined text-slate-200 dark:text-white/[0.06]" style="font-size:48px;">cloud_off</span><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:14px;margin-top:12px;">Connection error</p></div>';
                countEl.textContent = '';
                return;
            }

            var myData = await window.manifestEngine.getMyManifests();
            countEl.textContent = myData.length > 0 ? '(' + myData.length + ')' : '';

            if (!myData.length) {
                body.innerHTML = '<div class="my-modal-empty"><span class="material-symbols-outlined text-slate-200 dark:text-white/[0.06]" style="font-size:48px;font-variation-settings:\'FILL\' 1;">edit_note</span><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:14px;margin-top:12px;">You have no manifests yet</p><p class="text-slate-300 dark:text-white/[0.08]" style="font-size:12px;margin-top:4px;">Tap the + button to create your first one!</p></div>';
                return;
            }

            var html = '';
            for (var i = 0; i < myData.length; i++) {
                var m = myData[i];
                var catLabel = CAT_LABELS[m.category] || 'General';
                var dateStr = '';
                if (m.created_at) {
                    var d = new Date(m.created_at);
                    dateStr = d.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' });
                }

                html += '<div class="my-manifest-item fade-up" style="animation-delay:' + (i * 0.04) + 's;" id="my-m-' + m.id + '">' +
                    '<button class="my-manifest-delete" onclick="event.stopPropagation();deleteMyManifest(\'' + m.id + '\')" title="Delete">' +
                        '<span class="material-symbols-outlined">delete</span>' +
                    '</button>' +
                    '<span class="my-manifest-cat">' + catLabel + '</span>' +
                    '<p class="my-manifest-text">"' + m.text + '"</p>' +
                    '<div class="my-manifest-meta">' +
                        '<span class="my-manifest-date">' + dateStr + '</span>' +
                        '<span class="my-manifest-likes"><span class="material-symbols-outlined" style="font-variation-settings:\'FILL\' 1;">favorite</span> ' + (m.likes || 0) + ' likes</span>' +
                    '</div>' +
                '</div>';
            }
            body.innerHTML = html;
        };

        window.closeMyManifests = function() {
            document.getElementById('my-manifests-modal').style.display = 'none';
        };

        window.deleteMyManifest = async function(manifestId) {
            if (!window.manifestEngine) return;
            if (!confirm('Delete this manifest?')) return;

            var success = await window.manifestEngine.deleteMy(manifestId);
            if (success) {
                var el = document.getElementById('my-m-' + manifestId);
                if (el) {
                    el.style.transition = 'all 0.3s ease';
                    el.style.opacity = '0';
                    el.style.transform = 'translateX(60px)';
                    setTimeout(function() { el.remove(); }, 300);
                }
                for (var i = feedData.length - 1; i >= 0; i--) {
                    if (feedData[i].id === manifestId) {
                        feedData.splice(i, 1);
                        break;
                    }
                }
                render();
                var countEl = document.getElementById('my-manifests-count');
                var remaining = document.querySelectorAll('.my-manifest-item');
                setTimeout(function() {
                    remaining = document.querySelectorAll('.my-manifest-item');
                    countEl.textContent = remaining.length > 0 ? '(' + remaining.length + ')' : '';
                    if (remaining.length === 0) {
                        document.getElementById('my-manifests-body').innerHTML = '<div class="my-modal-empty"><span class="material-symbols-outlined text-slate-200 dark:text-white/[0.06]" style="font-size:48px;font-variation-settings:\'FILL\' 1;">edit_note</span><p class="text-slate-400 dark:text-white/[0.15]" style="font-size:14px;margin-top:12px;">You have no manifests yet</p><p class="text-slate-300 dark:text-white/[0.08]" style="font-size:12px;margin-top:4px;">Tap the + button to create your first one!</p></div>';
                    }
                }, 350);
            }
        };

        // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function init() {
            if (window.auth && window.auth.whenReady) await window.auth.whenReady();
            if (window.gamification) window.gamification.trackAction('manifest_community_visit');
            feedData = await loadFromSupabase();
            render();
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
    <script src="js/notification-engine.js"></script>
    <script src="js/bottom-nav.js"></script>
</body>
</html>
