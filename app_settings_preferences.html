<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>App Settings &amp; Preferences</title>
    <script src="js/theme-engine.js"></script>
    <script src="js/i18n-engine.js"></script>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/play-billing.js"></script>
    <script src="js/premium.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ecb613",
                        "background-light": "#f8f8f6",
                        "background-dark": "#181611",
                        "surface-dark": "#221d10", "surface-light": "#ffffff",
                        "border-dark": "#393528"
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .custom-toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .custom-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #393528;
            transition: .4s;
            border-radius: 34px;
        }

        html:not(.dark) .slider {
            background-color: #cbd5e1;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #ecb613;
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white min-h-screen">
    <div
        class="max-w-md mx-auto min-h-screen flex flex-col bg-background-light dark:bg-background-dark relative overflow-hidden">
        <!-- Subtle Background Pattern -->
        <div class="absolute inset-0 opacity-10 pointer-events-none"
            style="background-image: radial-gradient(#ecb613 0.5px, transparent 0.5px); background-size: 24px 24px;">
        </div>
        <!-- Top Navigation Bar -->
        <div
            class="sticky top-0 z-10 flex items-center bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md p-4 pb-2 justify-between">
            <div onclick="window.location.href='profile_soul_journey.html'"
                class="text-slate-900 dark:text-white flex size-12 shrink-0 items-center justify-start cursor-pointer">
                <span class="material-symbols-outlined text-[24px]">arrow_back_ios</span>
            </div>
            <h2
                class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12 font-display"
                data-i18n="settings.title">
                Settings</h2>
        </div>
        <div class="flex-1 overflow-y-auto pb-10 relative z-0">
            <!-- Personal Information Section -->
            <div class="mt-4">
                <h3
                    class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 font-display"
                    data-i18n="settings.personal_info">
                    Personal Information</h3>
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-[72px] py-2 justify-between cursor-pointer border-b border-slate-100 dark:border-border-dark">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-12">
                            <span class="material-symbols-outlined">person</span>
                        </div>
                        <div class="flex flex-col justify-center">
                            <p class="text-slate-900 dark:text-white text-base font-medium leading-normal line-clamp-1"
                                data-i18n="settings.fullname">
                                Full Name</p>
                            <p id="settings-fullname"
                                class="text-slate-500 dark:text-[#b9b29d] text-sm font-normal leading-normal line-clamp-1">
                                Yükleniyor...</p>
                        </div>
                    </div>
                    <div class="shrink-0">
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                </div>
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-[72px] py-2 justify-between cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-12">
                            <span class="material-symbols-outlined">auto_awesome</span>
                        </div>
                        <div class="flex flex-col justify-center">
                            <p class="text-slate-900 dark:text-white text-base font-medium leading-normal line-clamp-1"
                                data-i18n="settings.birthdate">
                                Birthdate</p>
                            <p id="settings-birthdate"
                                class="text-slate-500 dark:text-[#b9b29d] text-sm font-normal leading-normal line-clamp-1">
                                Yükleniyor...</p>
                        </div>
                    </div>
                    <div class="shrink-0">
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                </div>
            </div>
            <!-- Notifications Section -->
            <div class="mt-6">
                <h3
                    class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 font-display"
                    data-i18n="settings.notifications">
                    Notification Preferences</h3>
                <!-- Daily Insight Toggle -->
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-16 justify-between border-b border-slate-100 dark:border-border-dark">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">light_mode</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.daily_insight">
                            Daily Numerology Insight</p>
                    </div>
                    <label class="custom-toggle">
                        <input checked="" type="checkbox" />
                        <span class="slider"></span>
                    </label>
                </div>
                <!-- Lunar Alerts Toggle -->
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-16 justify-between border-b border-slate-100 dark:border-border-dark">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">dark_mode</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.lunar_alerts">
                            Lunar Phase Alerts</p>
                    </div>
                    <label class="custom-toggle">
                        <input checked="" type="checkbox" />
                        <span class="slider"></span>
                    </label>
                </div>
                <!-- Generic Notification Settings -->
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-16 justify-between cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">notifications_active</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.system_notif">
                            System Notifications</p>
                    </div>
                    <div class="shrink-0">
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                </div>
            </div>
            <!-- Appearance Section -->
            <div class="mt-6">
                <h3
                    class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 font-display"
                    data-i18n="settings.appearance">
                    Görünüm</h3>
                <!-- Theme Toggle -->
                <div
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-16 justify-between border-b border-slate-100 dark:border-border-dark">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span id="theme-icon" class="material-symbols-outlined">dark_mode</span>
                        </div>
                        <div class="flex flex-col">
                            <p class="text-slate-900 dark:text-white text-base font-normal leading-normal"
                                data-i18n="settings.dark_mode">
                                Karanlık Mod</p>
                            <p id="theme-label" class="text-slate-500 dark:text-[#b9b29d] text-xs">
                                Aktif</p>
                        </div>
                    </div>
                    <label class="custom-toggle">
                        <input id="theme-toggle" type="checkbox" />
                        <span class="slider"></span>
                    </label>
                </div>
                <!-- Language Selector -->
                <div id="btn-language-selector"
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-16 justify-between cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">language</span>
                        </div>
                        <div class="flex flex-col">
                            <p class="text-slate-900 dark:text-white text-base font-normal leading-normal" data-i18n="settings.language">
                                Dil</p>
                            <p id="current-lang-label" class="text-slate-500 dark:text-[#b9b29d] text-xs">
                                Türkçe</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 shrink-0">
                        <span id="current-lang-flag" class="text-lg">&#x1F1F9;&#x1F1F7;</span>
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                </div>
            </div>
            <!-- Subscription & Billing Section -->
            <div class="mt-6" id="sec-subscription">
                <h3
                    class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 font-display"
                    data-i18n="settings.subscription">
                    Abonelik & Faturalandırma</h3>
                <!-- Plan Status Card -->
                <div id="sub-card" class="mx-4 rounded-xl overflow-hidden" style="background:linear-gradient(135deg,rgba(139,92,246,0.08),rgba(236,72,153,0.04));border:1px solid rgba(139,92,246,0.12)">
                    <div class="p-4 flex items-center gap-4">
                        <div id="sub-icon" class="size-12 rounded-full flex items-center justify-center shrink-0" style="background:linear-gradient(135deg,#8b5cf6,#ec4899)">
                            <span class="material-symbols-outlined text-white text-xl" style="font-variation-settings:'FILL' 1">workspace_premium</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p id="sub-title" class="text-slate-900 dark:text-white text-base font-bold">Yükleniyor...</p>
                            <p id="sub-detail" class="text-slate-500 dark:text-[#b9b29d] text-xs mt-0.5">Abonelik bilgileri kontrol ediliyor</p>
                        </div>
                        <div id="sub-badge" class="shrink-0 px-3 py-1 rounded-full text-xs font-bold" style="display:none"></div>
                    </div>
                    <!-- Expiry info (premium only) -->
                    <div id="sub-expiry" class="px-4 pb-3" style="display:none">
                        <div class="flex items-center gap-2 text-xs" style="color:rgba(139,92,246,0.6)">
                            <span class="material-symbols-outlined" style="font-size:14px">schedule</span>
                            <span id="sub-expiry-text"></span>
                        </div>
                    </div>
                </div>
                <!-- Action Buttons -->
                <div id="sub-actions" class="px-4 mt-3 space-y-0">
                    <!-- Upgrade button (free users) -->
                    <div id="sub-upgrade"
                        class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between cursor-pointer rounded-t-lg border-b border-slate-100 dark:border-border-dark"
                        style="display:none"
                        onclick="if(window.premium)window.premium.showPaywall('Tüm özelliklere sınırsız erişim için Premium\'a geç!')">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-lg shrink-0 size-10" style="background:rgba(139,92,246,0.1)">
                                <span class="material-symbols-outlined" style="color:#8b5cf6">upgrade</span>
                            </div>
                            <p class="text-slate-900 dark:text-white text-base font-medium leading-normal">Premium'a Yükselt</p>
                        </div>
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                    <!-- Manage subscription (premium users) -->
                    <div id="sub-manage"
                        class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between cursor-pointer rounded-t-lg border-b border-slate-100 dark:border-border-dark"
                        style="display:none">
                        <div class="flex items-center gap-4">
                            <div class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                                <span class="material-symbols-outlined">manage_accounts</span>
                            </div>
                            <p class="text-slate-900 dark:text-white text-base font-normal leading-normal">Aboneliği Yönet</p>
                        </div>
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                    <!-- Restore purchases (native only) -->
                    <div id="sub-restore"
                        class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between cursor-pointer rounded-b-lg"
                        style="display:none">
                        <div class="flex items-center gap-4">
                            <div class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                                <span class="material-symbols-outlined">restore</span>
                            </div>
                            <p id="sub-restore-text" class="text-slate-900 dark:text-white text-base font-normal leading-normal">Satın Alımları Geri Yükle</p>
                        </div>
                        <span class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span>
                    </div>
                </div>
            </div>

            <!-- Security & Privacy Section -->
            <div class="mt-6">
                <h3
                    class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 font-display"
                    data-i18n="settings.security">
                    Security &amp; Legal</h3>
                <div id="btn-change-password"
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between border-b border-slate-100 dark:border-border-dark cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">lock</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.change_password">
                            Change Password</p>
                    </div>
                    <div class="shrink-0"><span
                            class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span></div>
                </div>
                <div id="btn-privacy-policy"
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between border-b border-slate-100 dark:border-border-dark cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">verified_user</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.privacy_policy">
                            Privacy Policy</p>
                    </div>
                    <div class="shrink-0"><span
                            class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span></div>
                </div>
                <div id="btn-terms-of-service"
                    class="flex items-center gap-4 bg-white dark:bg-surface-dark px-4 min-h-14 justify-between cursor-pointer">
                    <div class="flex items-center gap-4">
                        <div
                            class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
                            <span class="material-symbols-outlined">description</span>
                        </div>
                        <p class="text-slate-900 dark:text-white text-base font-normal leading-normal flex-1 truncate"
                            data-i18n="settings.terms">
                            Terms of Service</p>
                    </div>
                    <div class="shrink-0"><span
                            class="material-symbols-outlined text-slate-400 dark:text-white">chevron_right</span></div>
                </div>
            </div>
            <!-- Destructive Actions -->
            <div class="mt-8 px-4 space-y-4">
                <button id="btn-logout"
                    class="w-full h-14 rounded-xl border border-slate-200 dark:border-border-dark text-slate-900 dark:text-white font-semibold flex items-center justify-center gap-2 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors">
                    <span class="material-symbols-outlined">logout</span>
                    <span data-i18n="settings.logout">Log Out</span>
                </button>
                <button
                    class="w-full h-14 rounded-xl text-red-500 font-semibold flex items-center justify-center gap-2 hover:bg-red-500/5 transition-colors">
                    <span class="material-symbols-outlined">delete_forever</span>
                    <span data-i18n="settings.delete_account">Delete Account</span>
                </button>
            </div>
            <!-- Version Footer -->
            <div class="mt-8 text-center px-4">
                <p class="text-slate-400 dark:text-[#b9b29d] text-xs font-normal" data-i18n="settings.version_footer">Your spiritual data is encrypted using
                    256-bit AES protection.</p>
                <p class="text-slate-400 dark:text-[#b9b29d] text-xs font-normal mt-2">V 2.4.1 — Made with stardust</p>
            </div>
        </div>
    </div>

    <script>
            // NUMERAEL APP - Navigation Helper
            (function () {
                // Auto navigation için
                var autoTarget = '';
                var autoDelay = 2500;

                if (autoTarget) {
                    setTimeout(function () {
                        window.location.href = autoTarget;
                    }, autoDelay);
                }

                // Bottom nav linkleri ekle
                setTimeout(function () {
                    // Home button
                    var allBtns = document.querySelectorAll('button, a');
                    allBtns.forEach(function (btn) {
                        var text = btn.textContent || '';
                        var html = btn.innerHTML || '';

                        // Home nav
                        if ((text.includes('Home') || html.includes('>home<')) && text.trim().length < 20) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'mystic_numerology_home_1.html';
                            });
                        }
                        // Crystal Store / Journal
                        if (text.includes('Crystal Store') || text.includes('Journal')) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'premium_crystal_store.html';
                            });
                        }
                        // Profile / Settings nav
                        if ((text.includes('Profile') || html.includes('>settings<')) && text.trim().length < 20) {
                            btn.addEventListener('click', function (e) {
                                e.preventDefault();
                                window.location.href = 'profile_soul_journey.html';
                            });
                        }
                    });
                }, 500);
            })();

        setTimeout(function () {

            // Real Log Out Logic
            var btnLogout = document.getElementById('btn-logout');
            if (btnLogout) {
                btnLogout.addEventListener('click', async function () {
                    try {
                        await window.auth.signOut();
                        window.location.href = 'mystic_splash_screen.html';
                    } catch (e) {
                        console.error('Logout error:', e);
                        window.location.href = 'mystic_splash_screen.html';
                    }
                });
            }

            // arrow_back → profile_soul_journey.html
            document.querySelectorAll('button, a, [class*="cursor"]').forEach(function (el) {
                var txt = (el.textContent || '') + (el.innerHTML || '');
                if (txt.includes('arrow_back')) {
                    el.style.cursor = 'pointer';
                    el.addEventListener('click', function (e) {
                        e.stopPropagation();
                        window.location.href = 'profile_soul_journey.html';
                    });
                }
            });

            // ─── Change Password ─────────────────────────────
            var btnChangePass = document.getElementById('btn-change-password');
            if (btnChangePass) {
                btnChangePass.addEventListener('click', async function() {
                    // Şifre değiştirme modalı göster
                    var overlay = document.createElement('div');
                    overlay.id = 'pw-overlay';
                    overlay.style.cssText = 'position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px)';
                    var isDark = document.documentElement.classList.contains('dark');
                    var modalBg = isDark ? '#221d10' : '#ffffff';
                    var modalBorder = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
                    var titleColor = isDark ? 'white' : '#1e293b';
                    var subtextColor = isDark ? 'rgba(255,255,255,0.5)' : '#64748b';
                    var rowBg = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.04)';
                    var rowBorder = isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)';
                    var iconColor = isDark ? 'rgba(255,255,255,0.4)' : '#94a3b8';
                    var emailColor = isDark ? 'rgba(255,255,255,0.8)' : '#334155';
                    var cancelBorder = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.15)';
                    var cancelColor = isDark ? 'white' : '#1e293b';
                    overlay.innerHTML =
                        '<div style="background:' + modalBg + ';border:1px solid ' + modalBorder + ';border-radius:20px;padding:28px 24px;width:90%;max-width:380px;box-shadow:0 25px 50px rgba(0,0,0,0.25)">' +
                            '<h3 style="color:' + titleColor + ';font-size:18px;font-weight:800;margin-bottom:4px;font-family:Manrope,sans-serif">Şifre Değiştir</h3>' +
                            '<p style="color:' + subtextColor + ';font-size:13px;margin-bottom:20px">E-posta adresinize şifre sıfırlama bağlantısı gönderilecek.</p>' +
                            '<div id="pw-email-row" style="display:flex;align-items:center;gap:10px;background:' + rowBg + ';border:1px solid ' + rowBorder + ';border-radius:12px;padding:12px 16px;margin-bottom:16px">' +
                                '<span class="material-symbols-outlined" style="color:' + iconColor + ';font-size:20px">mail</span>' +
                                '<span id="pw-email" style="color:' + emailColor + ';font-size:14px">Yükleniyor...</span>' +
                            '</div>' +
                            '<p id="pw-status" style="display:none;text-align:center;font-size:13px;margin-bottom:14px;padding:8px;border-radius:8px"></p>' +
                            '<div style="display:flex;gap:10px">' +
                                '<button id="pw-cancel" style="flex:1;height:44px;border-radius:12px;border:1px solid ' + cancelBorder + ';background:transparent;color:' + cancelColor + ';font-weight:600;font-size:14px;cursor:pointer;font-family:Manrope,sans-serif">İptal</button>' +
                                '<button id="pw-send" style="flex:1;height:44px;border-radius:12px;border:none;background:#ecb613;color:#181611;font-weight:700;font-size:14px;cursor:pointer;font-family:Manrope,sans-serif">Gönder</button>' +
                            '</div>' +
                        '</div>';
                    document.body.appendChild(overlay);

                    // Kullanıcı e-postasını göster
                    var pwEmailEl = document.getElementById('pw-email');
                    var userEmail = '';
                    try {
                        if (window.supabaseClient) {
                            var res = await window.supabaseClient.auth.getUser();
                            if (res.data && res.data.user && res.data.user.email) {
                                userEmail = res.data.user.email;
                                pwEmailEl.textContent = userEmail;
                            } else {
                                pwEmailEl.textContent = 'E-posta bulunamadı';
                            }
                        }
                    } catch(e) { pwEmailEl.textContent = 'E-posta alınamadı'; }

                    // İptal
                    document.getElementById('pw-cancel').addEventListener('click', function() {
                        overlay.remove();
                    });
                    overlay.addEventListener('click', function(e) {
                        if (e.target === overlay) overlay.remove();
                    });

                    // Gönder
                    document.getElementById('pw-send').addEventListener('click', async function() {
                        var statusEl = document.getElementById('pw-status');
                        var sendBtn = document.getElementById('pw-send');
                        if (!userEmail) {
                            statusEl.style.display = 'block';
                            statusEl.style.background = 'rgba(239,68,68,0.15)';
                            statusEl.style.color = '#ef4444';
                            statusEl.textContent = 'E-posta adresi bulunamadı.';
                            return;
                        }
                        sendBtn.textContent = 'Gönderiliyor...';
                        sendBtn.disabled = true;
                        try {
                            var result = await window.supabaseClient.auth.resetPasswordForEmail(userEmail);
                            if (result.error) throw result.error;
                            statusEl.style.display = 'block';
                            statusEl.style.background = 'rgba(16,185,129,0.15)';
                            statusEl.style.color = '#10b981';
                            statusEl.textContent = '✓ Şifre sıfırlama bağlantısı e-postanıza gönderildi!';
                            sendBtn.textContent = 'Gönderildi';
                            setTimeout(function() { overlay.remove(); }, 3000);
                        } catch(err) {
                            statusEl.style.display = 'block';
                            statusEl.style.background = 'rgba(239,68,68,0.15)';
                            statusEl.style.color = '#ef4444';
                            statusEl.textContent = 'Hata: ' + (err.message || 'Bilinmeyen hata');
                            sendBtn.textContent = 'Gönder';
                            sendBtn.disabled = false;
                        }
                    });
                });
            }

            // ─── Privacy Policy ─────────────────────────────
            var btnPrivacy = document.getElementById('btn-privacy-policy');
            if (btnPrivacy) {
                btnPrivacy.addEventListener('click', function() {
                    var isNative = window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();
                    var url = isNative ? 'https://soulmate-kohl.vercel.app/api/privacy-policy' : '/api/privacy-policy';
                    if (isNative && window.Capacitor.Plugins && window.Capacitor.Plugins.Browser) {
                        window.Capacitor.Plugins.Browser.open({ url: 'https://soulmate-kohl.vercel.app/api/privacy-policy' });
                    } else {
                        window.open(url, '_blank');
                    }
                });
            }

            // ─── Terms of Service ───────────────────────────
            var btnTerms = document.getElementById('btn-terms-of-service');
            if (btnTerms) {
                btnTerms.addEventListener('click', function() {
                    var isNative = window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();
                    var url = isNative ? 'https://soulmate-kohl.vercel.app/api/terms-of-service' : '/api/terms-of-service';
                    if (isNative && window.Capacitor.Plugins && window.Capacitor.Plugins.Browser) {
                        window.Capacitor.Plugins.Browser.open({ url: 'https://soulmate-kohl.vercel.app/api/terms-of-service' });
                    } else {
                        window.open(url, '_blank');
                    }
                });
            }

        }, 100);

        // ─── Subscription Management Logic ─────────────────────
        setTimeout(async function() {
            var subTitle = document.getElementById('sub-title');
            var subDetail = document.getElementById('sub-detail');
            var subBadge = document.getElementById('sub-badge');
            var subExpiry = document.getElementById('sub-expiry');
            var subExpiryText = document.getElementById('sub-expiry-text');
            var subUpgrade = document.getElementById('sub-upgrade');
            var subManage = document.getElementById('sub-manage');
            var subRestore = document.getElementById('sub-restore');
            var subIcon = document.getElementById('sub-icon');
            var subCard = document.getElementById('sub-card');

            var isNative = window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();

            // Premium durumunu kontrol et
            var isPremiumUser = false;
            var premiumData = null;
            try {
                var cache = JSON.parse(localStorage.getItem('numerael_premium') || 'null');
                if (cache && cache.active) {
                    if (!cache.expires_at || new Date(cache.expires_at) > new Date()) {
                        isPremiumUser = true;
                        premiumData = cache;
                    }
                }
            } catch(e) {}

            // Async full check
            if (!isPremiumUser && window.premium) {
                isPremiumUser = await window.premium.checkStatus();
                if (isPremiumUser) {
                    try { premiumData = JSON.parse(localStorage.getItem('numerael_premium') || 'null'); } catch(e) {}
                }
            }

            if (isPremiumUser) {
                // ─── Premium User UI ───
                var planLabel = premiumData && premiumData.plan === 'yearly' ? 'Yıllık Plan' : premiumData && premiumData.plan ? 'Aylık Plan' : 'Premium';
                var sourceLabel = premiumData && premiumData.source === 'paddle' ? 'Web' :
                                  premiumData && premiumData.source === 'play_store' ? 'Google Play' :
                                  premiumData && premiumData.source === 'supabase' ? 'Sunucu' : 'Aktif';

                subTitle.textContent = 'Numantic Premium';
                subDetail.textContent = planLabel + ' · ' + sourceLabel;

                subBadge.textContent = 'AKTİF';
                subBadge.style.display = 'block';
                subBadge.style.background = 'rgba(16,185,129,0.15)';
                subBadge.style.color = '#10b981';

                // Expiry date
                if (premiumData && premiumData.expires_at) {
                    var expDate = new Date(premiumData.expires_at);
                    var now = new Date();
                    var daysLeft = Math.ceil((expDate - now) / (1000 * 60 * 60 * 24));
                    subExpiryText.textContent = 'Yenileme: ' + expDate.toLocaleDateString('tr-TR') + ' (' + daysLeft + ' gün)';
                    subExpiry.style.display = 'block';
                }

                // Manage button
                subManage.style.display = 'flex';
                subManage.addEventListener('click', function() {
                    if (isNative) {
                        var platform = window.Capacitor.getPlatform();
                        if (platform === 'ios') {
                            window.open('https://apps.apple.com/account/subscriptions', '_system');
                        } else {
                            window.open('https://play.google.com/store/account/subscriptions', '_system');
                        }
                    } else {
                        // Web: Paddle customer portal
                        alert('Abonelik yönetimi için e-posta adresinize gönderilen Paddle bağlantısını kullanın.');
                    }
                });

            } else {
                // ─── Free User UI ───
                var isDarkMode = document.documentElement.classList.contains('dark');
                subIcon.style.background = 'rgba(139,92,246,0.15)';
                subIcon.innerHTML = '<span class="material-symbols-outlined" style="color:#a78bfa;font-size:22px">lock</span>';
                subCard.style.background = isDarkMode ? 'rgba(57,54,40,0.3)' : 'rgba(0,0,0,0.03)';
                subCard.style.border = isDarkMode ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.06)';

                subTitle.textContent = 'Ücretsiz Plan';
                subDetail.textContent = 'Temel özellikler · Sınırlı kullanım';

                subBadge.textContent = 'FREE';
                subBadge.style.display = 'block';
                subBadge.style.background = isDarkMode ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
                subBadge.style.color = isDarkMode ? 'rgba(255,255,255,0.4)' : '#94a3b8';

                subUpgrade.style.display = 'flex';
            }

            // Native: Restore purchases butonu
            if (isNative) {
                subRestore.style.display = 'flex';
                subRestore.addEventListener('click', async function() {
                    var restoreText = document.getElementById('sub-restore-text');
                    restoreText.textContent = 'Geri yükleniyor...';
                    if (window.premium && window.premium.restorePurchases) {
                        var ok = await window.premium.restorePurchases();
                        if (ok) {
                            restoreText.textContent = 'Başarılı! Yenileniyor...';
                        } else {
                            restoreText.textContent = 'Aktif abonelik bulunamadı';
                            setTimeout(function() { restoreText.textContent = 'Satın Alımları Geri Yükle'; }, 2500);
                        }
                    }
                });
            }

            // Premium değişikliği dinle
            window.addEventListener('numerael:premium-changed', function() {
                window.location.reload();
            });

        }, 300);
    </script>


    <script>
    // ─── Load Real User Data ─────────────────────────────
    (function() {
        function loadUserInfo() {
            var nameEl = document.getElementById('settings-fullname');
            var birthEl = document.getElementById('settings-birthdate');

            // 1. localStorage'dan oku
            try {
                var cached = JSON.parse(localStorage.getItem('numerael_user_data') || 'null');
                if (cached) {
                    if (cached.name && nameEl) nameEl.textContent = cached.name;
                    if (cached.birthDate && birthEl) {
                        var d = new Date(cached.birthDate);
                        birthEl.textContent = d.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
                    }
                }
            } catch(e) {}

            // 2. Supabase'den güncel veri çek
            if (window.auth && window.auth.whenReady) {
                window.auth.whenReady().then(function() {
                    var client = window.supabaseClient;
                    if (!client) return;
                    client.auth.getUser().then(function(res) {
                        if (!res.data || !res.data.user) return;
                        var userId = res.data.user.id;
                        client.from('profiles').select('full_name, birth_date').eq('id', userId).single().then(function(r) {
                            if (r.data) {
                                if (r.data.full_name && nameEl) nameEl.textContent = r.data.full_name;
                                if (r.data.birth_date && birthEl) {
                                    var bd = new Date(r.data.birth_date);
                                    birthEl.textContent = bd.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
                                }
                            }
                        });
                    });
                });
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadUserInfo);
        } else {
            loadUserInfo();
        }
    })();
    </script>
<script>
    // ─── Theme Toggle Logic ─────────────────────────────
    (function() {
        var toggle = document.getElementById('theme-toggle');
        var icon = document.getElementById('theme-icon');
        var label = document.getElementById('theme-label');
        if (!toggle || !window.themeEngine) return;

        function updateUI() {
            var isDark = window.themeEngine.isDark();
            toggle.checked = isDark;
            if (icon) icon.textContent = isDark ? 'dark_mode' : 'light_mode';
            if (label) label.textContent = isDark ? 'Aktif' : 'Kapalı';
        }

        // Initialize
        updateUI();

        // Toggle handler
        toggle.addEventListener('change', function() {
            var theme = toggle.checked ? 'dark' : 'light';
            window.themeEngine.set(theme);
            updateUI();
        });

        // Listen for external theme changes
        window.addEventListener('themechange', updateUI);
    })();
    </script>
<script src="js/notification-engine.js"></script>
<script src="js/bottom-nav.js"></script>
<script>
// ─── Language Selector Logic ─────────────────────────────
(function() {
    var langBtn = document.getElementById('btn-language-selector');
    var langLabel = document.getElementById('current-lang-label');
    var langFlag = document.getElementById('current-lang-flag');
    if (!langBtn || !window.i18n) return;

    function updateLangUI() {
        var cur = window.i18n.current();
        var langs = window.i18n.languages();
        for (var i = 0; i < langs.length; i++) {
            if (langs[i].code === cur) {
                if (langLabel) langLabel.textContent = langs[i].native;
                if (langFlag) langFlag.textContent = langs[i].flag;
                break;
            }
        }
    }
    updateLangUI();

    langBtn.addEventListener('click', function() {
        var langs = window.i18n.languages();
        var overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)';
        var isDark = document.documentElement.classList.contains('dark');
        var bg = isDark ? '#221d10' : '#ffffff';
        var border = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
        var textColor = isDark ? '#fff' : '#1e293b';
        var activeBg = isDark ? 'rgba(236,182,19,0.15)' : 'rgba(236,182,19,0.1)';

        var html = '<div style="background:' + bg + ';border:1px solid ' + border + ';border-radius:20px;padding:24px;width:90%;max-width:340px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.25)">';
        html += '<h3 style="color:' + textColor + ';font-size:16px;font-weight:800;margin-bottom:16px;text-align:center;font-family:Manrope,sans-serif">' + window.i18n.t('signup.select_language', 'Select Language') + '</h3>';
        html += '<div style="display:flex;flex-direction:column;gap:4px">';

        var current = window.i18n.current();
        for (var i = 0; i < langs.length; i++) {
            var l = langs[i];
            var isActive = l.code === current;
            var itemBg = isActive ? activeBg : 'transparent';
            var itemBorder = isActive ? '2px solid #ecb613' : '2px solid transparent';
            html += '<div class="lang-opt" data-lang="' + l.code + '" style="display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:12px;cursor:pointer;background:' + itemBg + ';border:' + itemBorder + ';transition:background 0.15s">';
            html += '<span style="font-size:24px">' + l.flag + '</span>';
            html += '<div style="flex:1"><p style="color:' + textColor + ';font-size:14px;font-weight:600;margin:0">' + l.native + '</p></div>';
            if (isActive) html += '<span class="material-symbols-outlined" style="color:#ecb613;font-size:20px">check_circle</span>';
            html += '</div>';
        }
        html += '</div></div>';
        overlay.innerHTML = html;
        document.body.appendChild(overlay);

        overlay.addEventListener('click', function(e) { if (e.target === overlay) overlay.remove(); });

        var opts = overlay.querySelectorAll('.lang-opt');
        for (var j = 0; j < opts.length; j++) {
            opts[j].addEventListener('click', function() {
                var lang = this.getAttribute('data-lang');
                window.i18n.set(lang);
                updateLangUI();
                overlay.remove();
            });
        }
    });

    window.addEventListener('languagechange', updateLangUI);
})();
</script>
</body>

</html>
