<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Karar Takvimi</title>
    <script src="js/api-base.js"></script>
    <script src="js/tailwind.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="js/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/revenuecat.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/gamification-engine.js"></script>
    <script src="js/profile.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#7f13ec",
                        "background-light": "#f7f6f8",
                        "background-dark": "#0a0118",
                        "cosmic-gold": "#ffd700",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .glass-card {
            background: rgba(33, 28, 39, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glow-gold {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
        }
        .cosmic-bg {
            background: radial-gradient(circle at top right, #1d0b3a 0%, #0a0118 100%);
        }
        body {
            min-height: max(884px, 100dvh);
        }#menu-toggle:checked ~ #sidebar {
            transform: translateX(0);
        }
        #menu-toggle:checked ~ #sidebar-overlay {
            display: block;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-white overflow-x-hidden min-h-screen">
    <input class="hidden" id="menu-toggle" type="checkbox" />
    <label class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] hidden transition-opacity duration-300"
        for="menu-toggle" id="sidebar-overlay"></label>
    <aside
        class="fixed top-0 left-0 h-full w-72 bg-background-dark/95 border-r border-white/10 z-[70] -translate-x-full transition-transform duration-300 ease-in-out backdrop-blur-xl"
        id="sidebar">
        <div class="flex flex-col h-full p-6">
            <div class="flex items-center justify-between mb-10">
                <h2 class="text-xl font-bold text-white">Menü</h2>
                <label class="text-white/60 cursor-pointer" for="menu-toggle">
                    <span class="material-symbols-outlined"
                        onclick="window.location.href='mystic_numerology_home_1.html'"
                        style="cursor:pointer">close</span>
                </label>
            </div>
            <nav class="flex flex-col gap-6">
                <a class="flex items-center gap-4 text-primary font-bold" href="#">
                    <span class="material-symbols-outlined"
                        style="font-variation-settings: 'FILL' 1">calendar_month</span>
                    <span>Takvim</span>
                </a>
                <a onclick="window.location.href='cosmic_manifest_portal.html'"
                    class="flex items-center gap-4 text-white/70 hover:text-white transition-colors font-medium cursor-pointer"
                    href="#">
                    <span class="material-symbols-outlined">explore</span>
                    <span>Planlayıcı</span>
                </a>
                <a class="flex items-center gap-4 text-white/70 hover:text-white transition-colors font-medium"
                    href="#">
                    <div class="size-8 bg-primary rounded-full flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-sm">add</span>
                    </div>
                    <span>Ritüel</span>
                </a>
                <a onclick="window.location.href='daily_spiritual_guide.html'"
                    class="flex items-center gap-4 text-white/70 hover:text-white transition-colors font-medium cursor-pointer"
                    href="#">
                    <span class="material-symbols-outlined">auto_graph</span>
                    <span>Günlük Rehber</span>
                </a>
                <a onclick="window.location.href='wheel_of_destiny.html'"
                    class="flex items-center gap-4 text-white/70 hover:text-white transition-colors font-medium border-t border-white/10 pt-6 mt-2 cursor-pointer"
                    href="#">
                    <span class="material-symbols-outlined">account_circle</span>
                    <span>Profil</span>
                </a>
                <a class="flex items-center gap-4 text-white/70 hover:text-white transition-colors font-medium"
                    href="#">
                    <span class="material-symbols-outlined">settings</span>
                    <span>Ayarlar</span>
                </a>
            </nav>
            <div class="mt-auto">
                <div class="bg-primary/10 rounded-xl p-4 border border-primary/20">
                    <p class="text-xs text-cosmic-gold font-bold uppercase mb-2">Günlük Durum</p>
                    <p class="text-sm text-white/80 italic">"Sayısal analiz aktif."</p>
                </div>
            </div>
        </div>
    </aside>
    <div class="fixed top-0 left-0 right-0 z-50 bg-background-dark/80 backdrop-blur-md">
        <div class="flex items-center p-4 justify-between max-w-md mx-auto">
            <button onclick="window.location.href='mystic_numerology_home_1.html'"
                style="cursor:pointer;width:44px;height:44px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:50%;color:white;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:0">
                <span class="material-symbols-outlined" style="font-size:22px;pointer-events:none">arrow_back_ios</span>
            </button>
            <h2 class="text-white text-lg font-bold leading-tight tracking-tight flex-1 text-center">Karar Takvimi
            </h2>
            <div class="text-white flex size-12 shrink-0 items-center justify-end">
                <span class="material-symbols-outlined">account_circle</span>
            </div>
        </div>
    </div>
    <main class="pt-20 pb-12 max-w-md mx-auto px-4 space-y-6">
        <section class="glass-card rounded-xl p-4">
            <div class="flex items-center justify-between mb-4">
                <button onclick="changeMonth(-1)" class="text-white/60 hover:text-white transition-colors">
                    <span class="material-symbols-outlined">chevron_left</span>
                </button>
                <p class="text-white text-base font-bold" id="month-label">—</p>
                <button onclick="changeMonth(1)" class="text-white/60 hover:text-white transition-colors"
                    id="next-month-btn">
                    <span class="material-symbols-outlined">chevron_right</span>
                </button>
            </div>
            <div class="grid grid-cols-7 text-center mb-2">
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Pz</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Pt</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Sa</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Ça</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Pe</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Cu</p>
                <p class="text-[#ab9db9] text-[11px] font-bold uppercase tracking-widest">Ct</p>
            </div>
            <div class="grid grid-cols-7 gap-y-2" id="calendar-grid">
                <!-- dinamik günler JS ile doldurulacak -->
            </div>
        </section>
        <div class="flex items-center justify-between px-2">
            <h2 class="text-white text-2xl font-bold tracking-tight">Günlük Analiz</h2>
            <div class="flex items-center gap-1 bg-primary/20 px-3 py-1 rounded-full">
                <span class="material-symbols-outlined text-cosmic-gold text-sm"
                    style="font-variation-settings: 'FILL' 1">analytics</span>
                <span class="text-xs font-bold text-cosmic-gold" id="alignment-label">Aktif Döngü</span>
            </div>
        </div>
        <div class="glass-card rounded-xl overflow-hidden shadow-2xl">
            <div class="p-6 space-y-5">
                <div>
                    <p class="text-cosmic-gold text-xs font-bold uppercase tracking-[0.2em] mb-2"
                        id="selected-date-label">Bugünün Titreşimi</p>
                    <h3 class="text-2xl font-bold text-white leading-tight mb-3" id="vibration-title">—</h3>
                    <p id="day-description" class="text-[#ab9db9] text-base leading-relaxed"></p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-primary/10 rounded-lg p-3 border border-primary/20">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="material-symbols-outlined text-primary text-sm">check_circle</span>
                            <span class="text-xs font-bold text-[#ab9db9] uppercase tracking-wider">Desteklenen</span>
                        </div>
                        <div id="supported-actions" class="space-y-1"></div>
                    </div>
                    <div class="bg-primary/10 rounded-lg p-3 border border-primary/20">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="material-symbols-outlined text-primary text-sm">warning</span>
                            <span class="text-xs font-bold text-[#ab9db9] uppercase tracking-wider">Zorlayıcı</span>
                        </div>
                        <div id="challenging-actions" class="space-y-1"></div>
                    </div>
                </div>
                <p class="text-[#ab9db9] text-xs text-center mb-3">Saatlik sayısal akışı inceleyerek kararlarınız için en uygun zaman dilimini görebilirsiniz.</p>
                <button id="decision-timing-cta"
                    class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-[0.98]"
                    style="position:relative;z-index:10;cursor:pointer;">
                    Bu Günün Karar Zamanlamasını Gör
                </button>
            </div>
        </div>
    </main>


    <script>
        // ===== DECISION CALENDAR ENGINE =====
        var TODAY = new Date();
        TODAY.setHours(0, 0, 0, 0);

        var currentYear = TODAY.getFullYear();
        var currentMonth = TODAY.getMonth(); // 0-11
        var selectedDate = new Date(TODAY);

        var MONTHS = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];

        // Vibrasyon hesaplama (gün sayılarını topla)
        function calcVibration(date) {
            var d = date.getDate();
            var m = date.getMonth() + 1;
            var y = date.getFullYear();
            var sum = 0;
            ('' + d + m + y).split('').forEach(function (c) { sum += parseInt(c); });
            while (sum > 9 && sum !== 11 && sum !== 22) {
                var s2 = 0;
                ('' + sum).split('').forEach(function (c) { s2 += parseInt(c); });
                sum = s2;
            }
            return sum;
        }

        // Günlük içerik verisi — fixed vibration map
        var VIBRATION_DATA = {
            1: {
                title: 'Titreşim 1 — Başlangıç & Aksiyon',
                desc: 'Bugün sayısal enerji, harekete geçmeyi ve doğrudan adım atmayı ön plana çıkarıyor. Yeni süreçlerin başlatılması, bireysel kararların netleştirilmesi ve ilk adımların atılması için elverişli bir zemin oluşuyor. Bekleme ve onay arayışı gibi pasif tutumlar bu enerjinin akışını yavaşlatabilir. Cesur ama bilinçli bir tempo, günün ritmini en iyi şekilde yakalamanıza yardımcı olabilir. Duygusal değerlendirmeler yerine somut çıktılara odaklanmak daha verimli sonuçlar doğurabilir.',
                supported: ['Yeni görevlere başlama (ivme güçlü)', 'İnisiyatif alma (bireysel güç yüksek)', 'Doğrudan iletişim (netlik destekleniyor)'],
                challenging: ['Onay bekleme (enerji durağanlaşır)', 'Pasif davranış (momentum kaybolur)'],
                alignment: 'Aktif Döngü'
            },
            2: {
                title: 'Titreşim 2 — Değerlendirme & Koordinasyon',
                desc: 'Günün enerjisi dengeyi, karşılıklı anlayışı ve iki taraflı değerlendirmeyi öne çıkarıyor. Birlikte yürütülen süreçler, ortak kararlar ve diplomatik yaklaşımlar bugün daha güçlü bir zemin buluyor. Tek başına verilen keskin kararlar ya da baskıcı tutumlar bu dengeyi bozabilir. Dinlemeye ve karşı tarafın perspektifini anlamaya alan tanımak, süreçleri kolaylaştırabilir. Sabırlı bir tempo, aceleci hamlelerden daha etkili sonuçlar üretebilir.',
                supported: ['Müzakere (denge enerjisi güçlü)', 'İlişki yönetimi (empati destekleniyor)', 'Dinleme (alıcı kanal açık)'],
                challenging: ['Tek başına kararlar (işbirliği daha verimli)', 'Agresif eylem (karşı tepki riski)'],
                alignment: 'Dengeli Döngü'
            },
            3: {
                title: 'Titreşim 3 — İfade & Üretim',
                desc: 'Bugün sayısal akış, ifade gücünü ve yaratıcı çıktıları destekliyor. Fikirlerin paylaşılması, iletişim kanallarının açılması ve yaratıcı projelerin ilerletilmesi için uygun bir enerji mevcut. Katı yapılar ve detay odaklı disiplin bugün ikinci planda kalabilir. Spontan ve akışkan bir tempo, yapılandırılmış planlardan daha verimli olabilir. Uzun vadeli taahhütler vermek yerine kısa vadeli üretkenliğe odaklanmak daha doğal hissedebilir.',
                supported: ['İletişim (ifade kanalı açık)', 'Pazarlama (mesaj iletimi güçlü)', 'Yaratıcı üretim (ilham destekleniyor)'],
                challenging: ['Detay ağırlıklı planlama (akış kesintiye uğrar)', 'Uzun vadeli taahhütler (esneklik tercih edilir)'],
                alignment: 'Üretim Döngüsü'
            },
            4: {
                title: 'Titreşim 4 — Yapı & Uygulama',
                desc: 'Günün enerjisi sistematik çalışmayı, somut adımları ve disiplinli uygulamayı ön plana çıkarıyor. Süreç oluşturma, organizasyon ve adım adım ilerleme bugün destekleniyor. Doğaçlama ya da ani yön değişiklikleri bu yapısal enerjinin verimini düşürebilir. Duygusal kararlar yerine mantık ve plan odaklı yaklaşımlar daha sağlam sonuçlar üretebilir. Tempolu ama tutarlı bir ilerleme, günün sayısal ritmini en iyi yansıtıyor.',
                supported: ['Operasyonlar (sistematik güç yüksek)', 'Planlama (yapısal netlik mevcut)', 'Süreç oluşturma (temel sağlam)'],
                challenging: ['Doğaçlama (yapı bozulabilir)', 'Duygusal kararlar (mantık daha güvenilir)'],
                alignment: 'Kararlı Döngü'
            },
            5: {
                title: 'Titreşim 5 — Değişim & Hareket',
                desc: 'Bugün sayısal enerji, hareketliliği, esnekliği ve hızlı uyum yeteneğini güçlendiriyor. Beklenmedik gelişmelere açık olmak ve kısa vadeli ayarlamalar yapmak bu enerjinin doğal akışına uygun düşüyor. Sabit planlar ve katı yapılar bugün baskı altında kalabilir. Değişime direnmek yerine ona eşlik etmek daha az enerji harcamanıza yardımcı olabilir. Hızlı düşünme ve çevik tepkiler, uzun süreli planlamadan daha etkili olabilir.',
                supported: ['Ayarlamalar (esneklik destekleniyor)', 'Kısa vadeli kararlar (hız avantaj)', 'Hareket (durağanlık uyumsuz)'],
                challenging: ['Uzun vadeli planlama (değişkenlik yüksek)', 'Katı yapılar (kırılganlık artar)'],
                alignment: 'Dinamik Döngü'
            },
            6: {
                title: 'Titreşim 6 — Sorumluluk & Denge',
                desc: 'Günün enerjisi bağlılığı, sorumluluğu ve mevcut süreçlerin korunmasını ön plana çıkarıyor. İlişkilerin bakımı, verilen sözlerin tutulması ve istikrarlı adımlar bu enerjiyle uyumlu. Yüksek riskli hamleler ve ani değişiklikler bugün beklenenden fazla direnç yaratabilir. Sakin ve dengeli bir tempo, agresif stratejilerden daha verimli sonuçlar doğurabilir. Var olanı güçlendirmek, yeni kapılar açmaktan daha destekli bir yolda ilerlemek anlamına gelebilir.',
                supported: ['İlişki bakımı (bağ enerjisi güçlü)', 'Sürdürme (devamlılık destekleniyor)', 'Sorumluluk üstlenme (güven oluşur)'],
                challenging: ['Yüksek riskli kararlar (denge bozulabilir)', 'Ani değişiklikler (istikrar tercih ediliyor)'],
                alignment: 'Dengeli Döngü'
            },
            7: {
                title: 'Titreşim 7 — Analiz & İç Odak',
                desc: 'Bugün sayısal enerji, gözlem gücünü, analitik düşünceyi ve içsel değerlendirmeyi derinleştiriyor. Araştırma, strateji geliştirme ve mevcut verilerin yeniden yorumlanması için elverişli bir dönem. Dışarıdan gelen baskılara tepki vermek yerine kendi iç pusulanıza danışmak daha net sonuçlar üretebilir. Zorla uygulama ve çatışma gibi dışsal eylemler bugün beklenenden az etki bırakabilir. Sessiz bir gözlem ve derin düşünce, gürültülü aksiyondan daha değerli olabilir.',
                supported: ['Analiz (gözlem derinliği artıyor)', 'Araştırma (veri işleme güçlü)', 'Planlama (stratejik netlik mevcut)'],
                challenging: ['Zorla uygulama (direnç yüksek)', 'Çatışma (enerji verimsiz harcanır)'],
                alignment: 'Yüksek Sayısal Yoğunluk'
            },
            8: {
                title: 'Titreşim 8 — Kontrol & Maddi Odak',
                desc: 'Günün enerjisi otoriteyi, finansal konuları ve kontrol bazlı eylemleri güçlendiriyor. Maddi kararlar, yönetim süreçleri ve liderlik gerektiren adımlar bugün sağlam bir zemin buluyor. Duygusal hassasiyet ise bu güçlü akışta geri planda kalabilir. Mantık ile duygu arasındaki dengeyi korumak, tek tarafa aşırı yüklenmemek günün en kritik noktalarından biri. Sonuç odaklı düşünmek desteklenirken, pasif bekleme ve erteleme enerjinin dağılmasına yol açabilir.',
                supported: ['Finansal kararlar (mantık ön planda)', 'Yönetim (otorite destekleniyor)', 'Otorite eylemleri (liderlik güçlü)'],
                challenging: ['Duygusal tartışmalar (hassasiyet azalmış)', 'Pasif bekleme (enerji dağılır)'],
                alignment: 'Güç Döngüsü'
            },
            9: {
                title: 'Titreşim 9 — Kapanış & Tamamlanma',
                desc: 'Bugün sayısal enerji, tamamlanmayı, sonlandırmayı ve döngülerin kapanmasını destekliyor. Yarım kalan işlerin bitirilmesi, eski süreçlerin gözden geçirilmesi ve sonuçların değerlendirilmesi için uygun bir zemin oluşuyor. Yeni başlangıçlar ve uzun vadeli girişimler ise bugün yeterli ivme bulamayabilir. Bitirme enerjisini değerlendirmek, başlatma enerjisini zorlamaktan daha verimli olabilir. Geçmişe bakmak ve ders çıkarmak, bu titreşimin en güçlü taraflarından biri.',
                supported: ['Tamamlama (kapanış enerjisi güçlü)', 'Süreçleri bitirme (sonuç netleşiyor)', 'Gözden geçirme (değerlendirme destekleniyor)'],
                challenging: ['Yeni projelere başlama (ivme yetersiz)', 'Uzun vadeli başlangıçlar (temel henüz zayıf)'],
                alignment: 'Tamamlanma Döngüsü'
            },
            11: {
                title: 'Titreşim 11 — Yüksek Sayısal Yoğunluk',
                desc: 'Üstat sayı olan 11, bugün tüm sayısal etkileri olağanüstü bir şekilde güçlendiriyor. Analitik derinlik artıyor, sezgisel kavrayış keskinleşiyor ve kararların ağırlığı belirgin biçimde yükseliyor. Bu yoğunluk, stratejik planlama ve araştırma için nadir bir fırsat penceresi açıyor. Aceleci ve yüzeysel eylemler bu derin enerjinin israf edilmesine yol açabilir. Sakin ama odaklanmış bir tempo, bu üstat titreşimin sunduğu potansiyeli en iyi şekilde değerlendirmeye yardımcı olabilir.',
                supported: ['Analiz (sezgisel derinlik artıyor)', 'Araştırma (kavrayış keskinleşiyor)', 'Stratejik planlama (vizyon genişliyor)'],
                challenging: ['Aceleci kararlar (yoğunluk dikkat ister)', 'Yüzeysel eylemler (potansiyel israf olur)'],
                alignment: 'Yüksek Sayısal Yoğunluk'
            },
            22: {
                title: 'Titreşim 22 — Üstat Uygulama',
                desc: 'Üstat sayı olan 22, bugün büyük ölçekli uygulama ve yapısal kararlar için güçlü bir zemin oluşturuyor. Geniş kapsamlı projelerin ilerletilmesi, temel yapıların güçlendirilmesi ve uzun vadeli stratejilerin somutlaştırılması bu enerjinin doğal akışına uygun düşüyor. Küçük ve rutin görevler bu yoğun enerjinin altında kaybolabilir. Kararsızlık, bu üstat titreşimin sunduğu momentum ile uyumsuz olabilir. Büyük düşünmek ve kalıcı adımlar atmak, bu nadir enerjinin en verimli kullanımı olabilir.',
                supported: ['Büyük projeler (kapsam genişliyor)', 'Yapısal kararlar (temel sağlamlaşıyor)', 'Uzun vadeli planlama (vizyon netleşiyor)'],
                challenging: ['Küçük görevler (enerji orantısız)', 'Kararsızlık (momentum kaybedilir)'],
                alignment: 'Yüksek Sayısal Yoğunluk'
            }
        };

        function getDayData(date) {
            var v = calcVibration(date);
            return VIBRATION_DATA[v] || VIBRATION_DATA[5];
        }

        function formatDate(date) {
            var d = date.getDate();
            var m = MONTHS[date.getMonth()];
            return d + ' ' + m + ' ' + date.getFullYear();
        }

        function renderCalendar() {
            var grid = document.getElementById('calendar-grid');
            var label = document.getElementById('month-label');
            var nextBtn = document.getElementById('next-month-btn');

            label.textContent = MONTHS[currentMonth] + ' ' + currentYear;

            // Gelecek ay butonunu devre dışı bırak
            var isFutureMonth = (currentYear > TODAY.getFullYear()) ||
                (currentYear === TODAY.getFullYear() && currentMonth > TODAY.getMonth());
            nextBtn.style.opacity = isFutureMonth ? '0.2' : '1';
            nextBtn.style.pointerEvents = isFutureMonth ? 'none' : 'auto';

            grid.innerHTML = '';

            var firstDay = new Date(currentYear, currentMonth, 1).getDay();
            var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            var daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();

            // Önceki ayın günleri (soluk)
            for (var i = firstDay - 1; i >= 0; i--) {
                var el = document.createElement('div');
                el.className = 'h-12 w-full flex items-center justify-center text-white/15 text-sm';
                el.textContent = daysInPrevMonth - i;
                grid.appendChild(el);
            }

            // Bu ayın günleri
            for (var day = 1; day <= daysInMonth; day++) {
                var date = new Date(currentYear, currentMonth, day);
                var isPast = date < TODAY;
                var isToday = date.getTime() === TODAY.getTime();
                var isFuture = date > TODAY;
                var isSelected = date.getTime() === selectedDate.getTime();
                var vib = calcVibration(date);

                var btn = document.createElement('button');
                btn.className = 'relative h-12 w-full';

                if (isFuture) {
                    // Gelecek günler: soluk, tıklanamaz
                    btn.disabled = true;
                    btn.innerHTML = '<div class="flex flex-col items-center justify-center opacity-25"><span class="text-sm">' + day + '</span><span class="text-[8px] text-white/40">V' + vib + '</span></div>';
                } else if (isSelected) {
                    // Seçili gün: altın highlight
                    btn.innerHTML = '<div class="flex size-10 mx-auto flex-col items-center justify-center rounded-lg bg-primary/20" style="box-shadow:0 0 15px rgba(255,215,0,0.3);border:2px solid #ffd700"><span class="text-sm font-bold text-cosmic-gold">' + day + '</span><span class="text-[8px] text-cosmic-gold font-bold">V' + vib + '</span></div>';
                } else if (isToday) {
                    // Bugün: belirgin ama seçili değil
                    btn.innerHTML = '<div class="flex flex-col items-center justify-center"><span class="text-sm font-bold text-white">' + day + '</span><span class="text-[8px] text-cosmic-gold font-bold">V' + vib + '</span></div>';
                } else {
                    // Geçmiş günler: normal, tıklanabilir
                    btn.innerHTML = '<div class="flex flex-col items-center justify-center"><span class="text-sm font-medium text-white/80">' + day + '</span><span class="text-[8px] text-primary font-bold">V' + vib + '</span></div>';
                }

                if (!isFuture) {
                    (function (d) {
                        btn.addEventListener('click', function () {
                            selectedDate = d;
                            renderCalendar();
                            updateDailyInfo(d);
                        });
                        btn.style.cursor = 'pointer';
                    })(new Date(date));
                }

                grid.appendChild(btn);
            }
        }

        function updateDailyInfo(date) {
            var data = getDayData(date);
            var isToday = date.getTime() === TODAY.getTime();

            document.getElementById('vibration-title').textContent = data.title;
            document.getElementById('selected-date-label').textContent = isToday ? "Bugünün Titreşimi" : formatDate(date);
            document.getElementById('day-description').textContent = data.desc;
            document.getElementById('alignment-label').textContent = data.alignment;

            // Supported actions
            var sa = document.getElementById('supported-actions');
            sa.innerHTML = (data.supported || []).map(function(s) {
                return '<p class="text-sm font-medium text-white">' + s + '</p>';
            }).join('');

            // Challenging actions
            var ca = document.getElementById('challenging-actions');
            ca.innerHTML = (data.challenging || []).map(function(c) {
                return '<p class="text-sm font-medium text-white/60">' + c + '</p>';
            }).join('');

            // Decision Timing CTA — pass selected date
            window._calendarSelectedDate = date;
        }

        function changeMonth(dir) {
            var newMonth = currentMonth + dir;
            var newYear = currentYear;
            if (newMonth > 11) { newMonth = 0; newYear++; }
            if (newMonth < 0) { newMonth = 11; newYear--; }

            // Gelecek aya geçmeyi engelle
            if (newYear > TODAY.getFullYear() || (newYear === TODAY.getFullYear() && newMonth > TODAY.getMonth())) return;

            currentMonth = newMonth;
            currentYear = newYear;
            renderCalendar();
        }

        // Decision Timing CTA click handler
        document.getElementById('decision-timing-cta').addEventListener('click', function() {
            if (window.aelOpen) {
                window.aelOpen();
            }
        });

        // Başlangıç
        renderCalendar();
        updateDailyInfo(TODAY);
    </script>

    <!-- Bottom Nav -->
    <nav
        class="fixed bottom-0 left-0 right-0 bg-background-dark/90 backdrop-blur-xl border-t border-white/10 flex items-center justify-around px-2 pb-2 pt-2 z-50">
        <button onclick="window.location.href='cosmic_energy_calendar_2.html'"
            class="flex flex-col items-center gap-1 text-primary py-1">
            <span class="material-symbols-outlined text-lg"
                style="font-variation-settings:'FILL' 1">calendar_month</span>
            <span class="text-[9px] font-bold uppercase tracking-tight">Takvim</span>
        </button>
        <button onclick="window.location.href='cosmic_manifest_portal.html'"
            class="flex flex-col items-center gap-1 text-white/40 py-1">
            <span class="material-symbols-outlined text-lg">explore</span>
            <span class="text-[9px] font-bold uppercase tracking-tight">Planlayıcı</span>
        </button>
        <div class="relative -top-4">
            <button
                class="size-14 rounded-full bg-primary flex items-center justify-center text-white shadow-lg border-4 border-background-dark">
                <span class="material-symbols-outlined text-2xl">add</span>
            </button>
            <span class="text-[9px] font-bold uppercase text-white/40 block text-center mt-1">Ritüel</span>
        </div>
        <button onclick="window.location.href='daily_spiritual_guide.html'"
            class="flex flex-col items-center gap-1 text-white/40 py-1">
            <span class="material-symbols-outlined text-lg">auto_graph</span>
            <span class="text-[9px] font-bold uppercase tracking-tight">Günlük Rehber</span>
        </button>
        <button onclick="window.location.href='wheel_of_destiny.html'"
            class="flex flex-col items-center gap-1 text-white/40 py-1">
            <span class="material-symbols-outlined text-lg">casino</span>
            <span class="text-[9px] font-bold uppercase tracking-tight">Profil</span>
        </button>
    </nav>
    <script src="js/numerology-context-engine.js"></script>
    <script src="js/decision-timing-engine.js"></script>
    <script src="js/numerology-ai.js"></script>
<script>if(window.gamification){window.gamification.trackAction('calendar_visit');}</script>
<script src="js/notification-engine.js"></script>
<script src="js/bottom-nav.js"></script>
</body>

</html>